import{a as D,b as Z}from"https://st-p.rmcdn.net/aab27dd3/dist/c/c-WO7XZULW.js";import{a as L,b as Y}from"https://st-p.rmcdn.net/aab27dd3/dist/c/c-4UKCF2GB.js";import{a as O,b as X}from"https://st-p.rmcdn.net/aab27dd3/dist/c/c-5IBIYDPK.js";import{c as E,d as J}from"https://st-p.rmcdn.net/aab27dd3/dist/c/c-ESZBX7KW.js";import{a as G}from"https://st-p.rmcdn.net/aab27dd3/dist/c/c-234U5CBJ.js";import{e as M,h as K}from"https://st-p.rmcdn.net/aab27dd3/dist/c/c-BDIKTVS7.js";import{b as H,c as U}from"https://st-p.rmcdn.net/aab27dd3/dist/c/c-XISRCAED.js";import{a as F}from"https://st-p.rmcdn.net/aab27dd3/dist/c/c-7E6CHA26.js";import{b as A}from"https://st-p.rmcdn.net/aab27dd3/dist/c/c-6ZBEBUM2.js";import{a as _,b as j}from"https://st-p.rmcdn.net/aab27dd3/dist/c/c-2DOLZMQC.js";import{a as S,d as C}from"https://st-p.rmcdn.net/aab27dd3/dist/c/c-QHP3NFJY.js";var k,B=S(()=>{"use strict";X();k={"template-common-form-button":O`
	<div class="button">
		<div class="caption"></div>
		<svg class="error" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 34 26"><path d="M17 19.8c-1.4 0-2.6 1.1-2.6 2.6s1.1 2.6 2.6 2.6c1.4 0 2.6-1.1 2.6-2.6S18.4 19.8 17 19.8zM19 0.4h-4L15 17.4h4L19 0.4z"/></svg>
		<div class="pending"></div>
		<svg class="show-if-empty-submitted-text" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 34 26"><path d="M31.4 3C30.6 2.3 29.4 2.3 28.6 3l0 0L13.1 18.6l-7.8-7.8 0 0c-0.8-0.7-2-0.7-2.7 0 -0.8 0.8-0.8 2 0 2.7l0 0L13.1 24.1l0.4-0.4h0L31.4 5.8l0 0C32.1 5 32.1 3.8 31.4 3z"/></svg>
	</div>
`}});var d,N,v,q,P,z=S(()=>{"use strict";d=C(F()),N=C(G()),v=C(A());J();B();j();U();Y();q=N.default.View.extend({MIN_FIELD_WIDTH:9,MIN_FIELD_HEIGHT:5,CAPTCHA_WIDTH:304,CAPTCHA_HEIGHT:78,CAPTCHA_INVISIBLE:!0,LINE_HEIGHT_FACTOR:1.2,INVALID_COLOR:"ff4828",INVALID_BORDER_WIDTH:2,DROPDOWN_TRIANGLE:{SVG:'<svg class="form-dropdown-triangle" width="9" height="6" preserveAspectRatio="none" viewBox="0 0 9 6" xmlns="http://www.w3.org/2000/svg"><path d="M3.763 5.196L.536 1.676A1 1 0 0 1 1.273 0h6.454a1 1 0 0 1 .737 1.676l-3.227 3.52a1 1 0 0 1-1.474 0z" fill-rule="evenodd"/></svg>',OPACITY_MULTIPLIER:.4,W:9,H:6,FONT_SIZE:18},CHECKBOX_TICK:{SVG:'<svg width="19" height="14" preserveAspectRatio="none" viewBox="0 0 19 14" xmlns="http://www.w3.org/2000/svg"><path d="M6.657 10.9L17.263.292a1 1 0 1 1 1.415 1.414L7.364 13.021a.997.997 0 0 1-1.414 0L.293 7.364A1 1 0 1 1 1.707 5.95l4.95 4.95z" fill-rule="evenodd"/></svg>',W:19,H:14,FONT_SIZE:18},initialize:function(t){v.default.bindAll(this),this.data=t.data,this.$container=t.$container,this.environment=t.environment,this.buttonTemplate=k["template-common-form-button"]},render:function(t={}){this.rendered?t.force&&this.$el&&this.$el.empty():(this.setElement((0,d.default)("<div>")),this.$el.addClass("form-wrapper").appendTo(this.$container),this.environment!=="constructor"&&this.$el.on(_.isDesktop()?"mouseenter":"touchstart",".button",this.onButtonHover).on(_.isDesktop()?"mouseleave":"touchend",".button",this.onButtonHoverOut),this.$el.on("change","select",this.onDropdownChange).on("mouseenter",".input-wrapper",this.onInputHover).on("mouseleave",".input-wrapper",this.onInputHoverOut),this.rendered=!0);let i=this.data,n=i.fields,e=(0,d.default)('<div><form enctype="multipart/form-data" method="post" target="form_submit_iframe"></form></div>'),s=e.find("form"),o,a,f=RM.constructorRouter&&RM.constructorRouter.previewMode,p=!!RM.constructorRouter,u=!1;if(RM.screenshot)window.ServerData.userPermissions&&window.ServerData.userPermissions.can_use_forms_file_upload&&(u=!0);else{let l=L.getPermissions();l&&l.can_use_forms_file_upload&&(u=!0)}for(let l=0;l<n.length;l++){let r=n[l];if(r.tp==="file"&&!u&&!p||r.tp==="captcha")continue;o=i.layout==="vertical"&&r.tp==="text",a=(0,d.default)(o?"<textarea>":"<input>"),a.addClass("js-input"),a.attr("type","text").attr("autocapitalize",r.tp==="name"?"on":"off").attr("autocomplete","off").attr("autocorrect","off").attr("name",r.caption).attr("placeholder",r.caption+(r.optional&&this.environment!=="viewer"?" (optional)":"")).attr("spellcheck",!1).attr("data-sort",r.sort),r.tp==="email"&&a.attr("inputmode","email"),r.tp==="phone"&&a.attr("inputmode","tel"),r.tp==="number"&&a.attr("inputmode","numeric"),r.tp==="checkbox"&&a.attr("type","checkbox"),r.tp==="dropdown"&&(a.attr({tabindex:-1}),a.prop({readonly:!0}),a.addClass("fake-dropdown"));let h=(0,d.default)('<div class="input-wrapper js-input-wrapper"/>');if(h.append(a),h.append('<div class="overlay"></div>'),this.environment!=="viewer"&&o){let c=(0,d.default)('<span class="input-line-control input-line-control-add js-add-line"></span>'),b=(0,d.default)('<span class="input-line-control input-line-control-remove js-remove-line"></span>');h.append(c).append(b)}if(r.tp==="file"){this.environment==="viewer"&&a.attr("type","file");let c=`formfiles-${this.data._id}${this.environment!=="viewer"?"-constructor":""}`;a.attr("name","formfiles"),a.attr("id",c),a.attr("multiple",""),a.attr("accept",(window.ServerData.config.FORMS_ACCEPTED_MIMES||[]).join(",")),a.addClass("input-file");let b=r.caption+(r.optional&&this.environment!=="viewer"?" (optional)":"")||"Add files";h.append((0,d.default)(`<label ${u?`for="${c}"`:""} class="input-file-label${this.environment!=="viewer"?" no-hover":""}" data-empty-text="${b}${f&&!u?" (Business plan only)":""}"><span class="files-name">${b}${f&&!u?" (Business plan only)":""}</span><span class="files-count"></span></label>`)),this.environment==="viewer"&&h.append((0,d.default)('<span class="input-file-control input-file-control-add">&nbsp;</span><span class="input-file-control input-file-control-remove">&nbsp;</span>'))}if(h.appendTo(s),r.tp==="dropdown"&&r.items){let c=(0,d.default)("<select>"),b=(0,d.default)(this.DROPDOWN_TRIANGLE.SVG);c.attr("name",r.caption),(0,d.default)('<option value="" selected></option>').prop("disabled",!r.optional).appendTo(c);for(let m=0;m<r.items.length;m++)(0,d.default)("<option>").attr("value",r.items[m]).text(r.items[m]).appendTo(c);a.parent().append(b).append(c)}if(r.tp==="checkbox"){let c=_.isDesktop()?"":"input-checkbox-wrapper-mobile";a.wrap('<label class="input-checkbox-wrapper '+c+'"></label>'),a.after('						<div class="input-checkbox-inner"> 							<span class="label">'+a.attr("placeholder")+'</span> 							<span class="tick">'+this.CHECKBOX_TICK.SVG+"</span> 						</div>")}}if((0,d.default)(this.buttonTemplate()).appendTo(s),this.$el.html(e.html()).addClass("common-form"),this.data.captcha&&!RM.common.isDownloadedSource){let l=E.generateUUID(),r=(0,d.default)(`<div id="${l}" class="captcha-holder captcha-invisible"></div>`);this.$el.find("form").append(r),window.recaptchaReadyPromise&&window.recaptchaReadyPromise.then(()=>{this.captcha=window.grecaptcha.render(l,{sitekey:window.ServerData.config.RECAPTCHA_SITEKEY,callback:this.captchaCallback.bind(this),theme:r.data("type")||"light",size:"invisible",isolated:!0})})}this.$button=this.$(".button"),this.$buttonIcons=this.$(".button svg"),this.data.cursorStyle&&this.$button.css("cursor",this.data.cursorStyle),this.$inputs=this.$(".input-wrapper"),this.$triangles=this.$(".form-dropdown-triangle"),this.$fileInputLabel=this.$inputs.find(".input-file-label"),this.$fileInputLabelText=this.$inputs.find(".input-file-label > .files-name"),this.$fileInputLabelCount=this.$inputs.find(".input-file-label > .files-count"),this.environment==="viewer"&&(this.$fileInput=this.$inputs.find(".input-file"),this.$fileInput&&this.$fileInput.on("change",this.onFileChange),this.$fileAddCtrl=this.$(".input-file-control-add"),this.$fileRemoveCtrl=this.$(".input-file-control-remove"),this.$fileRemoveCtrl&&this.$fileRemoveCtrl.on("click",this.onFileRemove)),this.recalcStyles()},executeCaptcha:function(t){if(!this.hasOwnProperty("captcha")){t();return}this.captchaExecuteCallback=t,window.grecaptcha.reset(this.captcha),window.grecaptcha.execute(this.captcha)},captchaCallback:function(t){this.captchaResponse=t,setTimeout(()=>this.captchaExecuteCallback(t),0)},validateFiles:function(t){if(!t||!t.length)return!0;let i=L.getPermissions();if(t.length>i.forms_file_upload_count)return alert(H.MSG_UPLOAD_FORMS_FILES_ERROR),!1;for(let n of t)if(n.size>i.forms_file_upload_limit)return alert(H.MSG_UPLOAD_FORMS_SIZE_ERROR),!1;return!0},onFileChange:function(){let t=this.$fileInput.get(0).files;if(!t||!t.length){this.$fileRemoveCtrl&&this.$fileRemoveCtrl.hide(),this.$fileAddCtrl&&this.$fileAddCtrl.show(),this.$fileInputLabelText.text(this.$fileInputLabel.data("emptyText")),this.$fileInputLabelCount.text(""),this.$fileInputLabel.removeClass("has-files");return}else{if(!this.validateFiles(t))return this.onFileRemove();this.$fileInputLabel.addClass("has-files"),this.$fileRemoveCtrl&&this.$fileRemoveCtrl.show(),this.$fileAddCtrl&&this.$fileAddCtrl.hide()}let i=(t[0].name||"Filename").split("\\").join("/").split("/").pop();this.$fileInputLabelText.text(i),this.$fileInputLabelCount.text(t.length>1?` +${t.length-1}`:"")},onFileRemove:function(){this.$fileInput.val(""),this.onFileChange()},onDropdownChange:function(t){(0,d.default)(t.currentTarget).parent().find(".js-input").val((0,d.default)(t.currentTarget).val())},setButtonHoverState:function(){this.forcePseudoState="hover",this.applyButtonStyle()},unsetButtonHoverState:function(){this.forcePseudoState=!1,this.applyButtonStyle()},recalcStyles:function(t){this.$el.attr("data-layout",this.data.layout).attr("data-style",this.data.style),this.$button.find(".caption").text(this.data["button-caption"]),this.resizeElements(t),this.applyInputsStyle(this.$inputs),this.applyButtonStyle(t)},getMinimalDimensions:function(){let t=this.data,i=t.fields,n=t["style-"+t.style+"-fields"],e=t["style-"+t.style+"-button-default"],s=this.getButtonValue.bind(this,e,n),o=i.find(h=>h.tp==="captcha"),a=e.gutter+(i.length-(o&&this.CAPTCHA_INVISIBLE?1:0))*n.gutter,f=n["underline-width"]||0,p=Math.max(Math.ceil(s("font-size")*this.LINE_HEIGHT_FACTOR),this.MIN_FIELD_HEIGHT)+f,u=Math.max(Math.ceil(n["font-size"]*this.LINE_HEIGHT_FACTOR),this.MIN_FIELD_HEIGHT)+f,l=Math.max(p,u),r;return t.layout==="vertical"&&(r={width:Math.max(o&&!this.CAPTCHA_INVISIBLE?this.CAPTCHA_WIDTH:0,this.MIN_FIELD_WIDTH),height:a+this.getTotalInputsHeight(i,l)+l}),t.layout==="horizontal"&&(r={width:a+i.length*this.MIN_FIELD_WIDTH+(e.width||0)+(o&&!this.CAPTCHA_INVISIBLE?this.CAPTCHA_WIDTH:this.MIN_FIELD_WIDTH),height:Math.max(l,o&&!this.CAPTCHA_INVISIBLE?this.CAPTCHA_HEIGHT:0)}),r},getTotalInputsHeight:function(t,i){return v.default.reduce(t,function(n,e){if(e.tp==="text"){let s=this.getExtraTextareaDimensions(e.rows,i);return n+s.height}return e.tp==="captcha"?n+this.CAPTCHA_INVISIBLE?0:this.CAPTCHA_HEIGHT:n+i}.bind(this),0)},getRowsCount:function(t){return v.default.reduce(t,function(i,n){let e=n.tp==="captcha"?0:n.tp==="text"&&n.rows||1;return i+e},0)},getInputDimensionsWithFixedButton:function(t){let i=this.data,n=i.fields,e=i["style-"+i.style+"-button-default"],s=i["style-"+i.style+"-fields"],o=i.layout==="vertical",a=e.width||0,f=e.width&&!o?n.length:n.length+1,p=n.find(y=>y.tp==="captcha"),u=e.gutter+(n.length+(p?-1:0))*s.gutter,l=t&&t.w!==void 0?t.w:i.w,r=t&&t.h!==void 0?t.h:i.h,h=Math.floor(o?r:l),c=o?this.CAPTCHA_HEIGHT:this.CAPTCHA_WIDTH,b=h-u-(p&&!this.CAPTCHA_INVISIBLE?c+s.gutter:0),m,w;if(o){let y=this.getLineHeight(),R=this.getRowsCount(n),I=b-R*y.input-y.input,T=Math.ceil(I/(f-(p?1:0)));m=y.input+T,w=this.getTotalInputsHeight(n,m)+m+u-h}else m=Math.ceil((b-a)/(f-(p?1:0))),w=m*(n.length+1)+u+a-h;return{overflow:w,itemSize:m,buttonSize:e.width&&!o?e.width:m,itemOtherSize:o?l:r,gutter:s.gutter,lastGutter:e.gutter+s.gutter}},getLineHeight:function(){let t=this.data||{},i=this.LINE_HEIGHT_FACTOR,n=this.getButtonValue(t["style-"+t.style+"-button-default"],t["style-"+t.style+"-fields"],"font-size"),e=t["style-"+t.style+"-fields"]["font-size"];return{input:Math.floor(i<10?i*e:i),button:Math.floor(i<10?i*n:i)}},getExtraTextareaDimensions:function(t=1,i){let n=this.getLineHeight(),e=Math.round(i-n.input),s=this.data&&this.data.style==="underlined",o=s?e:Math.ceil(e/2),a=s?0:Math.floor(e/2);return{height:t*n.input+o+a,top:o,bottom:a}},resizeElements:function(t){let i=this.data,n=i.layout==="vertical",e=i.fields,s=e.length,o=this.getInputDimensionsWithFixedButton(t),a=o.overflow,f=i.style,p=i["style-"+f+"-fields"],u=(p&&p["underline-width"]||0)+2;this.$inputs.add(this.$button).each(function(l,r){let h={},c=l>=s?o.buttonSize:o.itemSize,b=l===s-1,m=l<s,w=e[l],y=(0,d.default)(r),R=l>=s+1-a;if(R&&c--,h[n?"height":"width"]=c+"px",h[n?"width":"height"]=o.itemOtherSize+"px",m&&(h[n?"margin-bottom":"margin-right"]=b?o.lastGutter:o.gutter),h[n?"margin-right":"margin-bottom"]="",n&&w&&w.tp==="captcha"&&delete h.height,!n&&w&&w.tp==="captcha"&&delete h.width,n&&w&&w.tp==="text"){let I=w.rows||1,T=y.find(".js-input"),W=y.find(".js-add-line"),V=y.find(".js-remove-line"),$=this.getExtraTextareaDimensions(I,o.itemSize);h.height=$.height+(R?-1:0)+"px",T.css({top:$.top-u,bottom:$.bottom}),T.attr({rows:I}),W.css({top:$.top-u}),V.css({bottom:$.bottom+u}),y.toggleClass("is-multiline",I>1)}y.css(h)}.bind(this))},showInputPlaceholdersAsValues:function(t){this.$inputs.each(function(i,n){let e=(0,d.default)(n).find(".js-input");e.attr("type")==="checkbox"?e.parent().find(".label").addClass("input-checkbox-preview"):e.val(t?e.attr("placeholder"):"")})},applyInputsStyle:function(t,i={}){let n=this.data,e=v.default.clone(n["style-"+n.style+"-fields"]),s;n.style==="underlined"?(i.invalid&&(e["underline-color"]=this.INVALID_COLOR,e["underline-opacity"]=100,e["underline-width"]=e["underline-width"]||this.INVALID_BORDER_WIDTH),s={"background-color":"transparent","border-radius":0,"box-shadow":"inset 0 "+-e["underline-width"]*2+"px 0 "+-e["underline-width"]+"px "+this.getRgba(e["underline-color"],e["underline-opacity"])}):(i.invalid&&(e["border-color"]=this.INVALID_COLOR,e["border-opacity"]=100,e["border-width"]=e["border-width"]||this.INVALID_BORDER_WIDTH),s={"background-color":this.getRgba(e.color,e.opacity),"border-radius":e["border-radius"]+"px","box-shadow":"inset 0 0 0 "+e["border-width"]+"px "+this.getRgba(e["border-color"],e["border-opacity"])});let o={"font-family":e["font-family"],"font-style":e["font-style"],"font-weight":e["font-weight"],color:this.getRgba(e["text-color"],e["text-opacity"]),"font-size":e["font-size"],"letter-spacing":e["letter-spacing"],"margin-bottom":e["underline-width"]?e["underline-width"]+"px":0,"text-align":e["text-align"]||"left",direction:e.direction||"ltr"};t.filter(":not(.captcha-wrapper)").css(s).find(".js-input:not(.captcha-wrapper), select").css(o),t.find(".input-checkbox-inner .label").css(o),t.find(".input-file-label").css(o),t.find(".input-file-control").css(o),t.find(".js-add-line, .js-remove-line").css({"font-size":e["font-size"]}),t.find(".form-dropdown-triangle").each(function(a,f){let p=(0,d.default)(f),u=p.parent(),l=u.find(".js-input"),r=l.position().top,h=u.height()-l.height()-r,c=this.getSvgSizesFromFontSize(e["font-size"],"DROPDOWN_TRIANGLE");p.css({fill:this.getRgba(e["text-color"],e["text-opacity"]*this.DROPDOWN_TRIANGLE.OPACITY_MULTIPLIER),top:r,bottom:h,width:c.w,height:c.h})}.bind(this)),t.find(".input-checkbox-inner svg").each((a,f)=>{let p=(0,d.default)(f),u=this.getSvgSizesFromFontSize(e["font-size"],"CHECKBOX_TICK");p.css({fill:this.getRgba(e["text-color"],e["text-opacity"]),width:u.w,height:u.h})})},applyButtonStyle:function(){let t=this.data,i=t["style-"+t.style+"-fields"],n=t["style-"+t.style+"-button-default"],e=t["style-"+t.style+"-button-hover"],s=this.getButtonValue.bind(this,n,i),o=this.getHoverValue.bind(this,e,n,i),a=s("letter-spacing");this.$button.css({"line-height":this.$button.height()+"px","background-color":this.getRgba(s("color"),s("opacity")),"border-radius":s("border-radius")+"px","box-shadow":"inset 0 0 0 "+s("border-width")+"px "+this.getRgba(s("border-color"),s("border-opacity")),"font-family":s("font-family"),"font-style":s("font-style"),"font-weight":s("font-weight"),color:this.getRgba(s("text-color"),s("text-opacity")),"font-size":s("font-size"),"letter-spacing":a,"text-align":s("text-align")||"center","text-indent":a/2||0}),this.$buttonIcons.css({fill:this.getRgba(s("text-color"),s("text-opacity"))}),this.$button.attr("data-default",this.$button.attr("style")),this.$button.css({"background-color":this.getRgba(o("color"),o("opacity")),"box-shadow":"inset 0 0 0 "+o("border-width")+"px "+this.getRgba(o("border-color"),o("border-opacity")),color:this.getRgba(o("text-color"),o("text-opacity"))}),this.$button.attr("data-hover",this.$button.attr("style")),this.forcePseudoState||this.$button.attr("style",this.$button.attr("data-default")),this.$button.outerHeight(),this.$button.toggleClass("with-transition",!!e.transition&&this.environment==="viewer")},getRgba:function(t,i){let n=E.hex2rgb(t);return"rgba("+n[0]+", "+n[1]+","+n[2]+","+i/100+")"},getButtonValue:function(t,i,n){return t[n]==="inherit"?i[n]:t[n]},getHoverValue:function(t,i,n,e){return t[e]==="inherit"?this.getButtonValue(i,n,e):t[e]},onInputHover:function(t){let i=this.data,n=v.default.clone(i["style-"+i.style+"-fields"]);(0,d.default)(t.currentTarget).find(".form-dropdown-triangle").css("fill",this.getRgba(n["text-color"],n["text-opacity"]))},onInputHoverOut:function(t){let i=this.data,n=v.default.clone(i["style-"+i.style+"-fields"]);(0,d.default)(t.currentTarget).find(".form-dropdown-triangle").css("fill",this.getRgba(n["text-color"],n["text-opacity"]*this.DROPDOWN_TRIANGLE.OPACITY_MULTIPLIER))},onButtonHover:function(){this.$button.hasClass("submitted")||this.$button.attr("style",this.$button.attr("data-hover"))},onButtonHoverOut:function(){this.$button.attr("style",this.$button.attr("data-default"))},destroy:function(){this.$fileInput&&this.$fileInput.off("change",this.onFileChange),this.$el.off(_.isDesktop()?"mouseenter":"touchstart",".button",this.onButtonHover).off(_.isDesktop()?"mouseleave":"touchend",".button",this.onButtonHoverOut).off("change","select",this.onDropdownChange),this.$el&&this.$el.remove()},getSvgSizesFromFontSize:function(t,i){let n=this[i].H,e=this[i].W,s=this[i].FONT_SIZE;return{h:t*n/s,w:t*e/s}}}),P=q});var g,x,Q,ct,tt=S(()=>{g=C(F()),x=C(A());Z();z();K();Q=D.extend({DO_NOT_WAIT_FOR_PRELOAD:!0,NUMBER_TEST_REGEX:/^[0-9.,`']+$/,render:function(){if(this.makeBox("widget-form"),this.rendered=!0,this.captcha&&!window.recaptchaReadyPromise){let t;window.recaptchaReadyPromise=new Promise(i=>{t=i}),window.onloadRecaptchaCallback=function(){t()},(0,g.default)('<script src="https://www.google.com/recaptcha/api.js?onload=onloadRecaptchaCallback&render=explicit" async><\/script>').appendTo("head")}return this.seamlessFontsShow(function(){this.$el.removeClass("fonts-pending")}.bind(this),function(){this.$el.addClass("fonts-pending")}.bind(this)),this.formWidget=new P({data:this,environment:"viewer",$container:this.$el}),this.formWidget.render(),this.$button=this.$(".button"),this.$button.on("click",this.onButtonClick),this.$(".js-input").on("keydown",this.onInputKeyDown),this.$(".js-input").on("input",this.onInput),this.$("select").on("change",this.onInput),RM.screenshot?this.waitForUsedFontsLoad():this.widgetIsLoaded(),this},hasFontsToLoad:function(){return!0},destroy:function(){return this.formWidget&&this.formWidget.destroy(),this.formWidget=null,this.$(".button").off("click",this.onButtonClick),D.prototype.destroy.apply(this,arguments)},waitForUsedFontsLoad:function(){this.hasFontsToLoad()?this.page.addFontsToLoad(this,this.widgetIsLoaded):this.widgetIsLoaded()},onButtonClick:function(){this.$button.hasClass("submitted")||(this.setButtonState("pending"),this.formWidget.executeCaptcha(function(){this.sendForm()}.bind(this)))},sendForm:function(){if(!this.validateForm()){this.setButtonState();return}this.button_caption_after_submit==="Text after submit"||!this.button_caption_after_submit||this.submit_mode&&this.submit_mode!=="textAfterSubmit"?this.$button.addClass("empty-submitted-text"):this.$button.find(".caption").text(this.button_caption_after_submit),RM.common.isDownloadedSource&&!RM.common.homepageRewrite?this.submitToIframe(function(i){i?(this.setButtonState("error"),RM.analytics&&RM.analytics.sendEvent("rm_form_submit_error",i)):(this.setButtonState("submitted"),RM.analytics&&RM.analytics.sendEvent("form_submit"))}.bind(this)):this.submitForm(function(i){i?(this.setButtonState("error"),i.responseJSON&&i.responseJSON.name==="email_not_confirmed"&&x.default.delay(function(){alert(i.responseJSON.message)},100),RM.analytics&&RM.analytics.sendEvent("rm_form_submit_error",i)):(this.setButtonState("submitted"),RM.analytics&&RM.analytics.sendEvent("form_submit"))}.bind(this)),this.link_after_submit&&this.submit_mode&&this.submit_mode!=="textAfterSubmit"&&this.applyLink()},applyLink:function(){let t;this.submit_mode==="toUrlAfterSubmit"?this.openInNewTab(this.link_after_submit):(t=this.page.mag.getPageUri?"/"+this.page.mag.getPageUri(this.link_after_submit):"javascript:void(0)",this.mag.router.navigate(t,{trigger:!0}))},openInNewTab:function(t){Object.assign(document.createElement("a"),{target:"_blank",rel:"noopener",href:t}).click()},getDataBySort:function(t){return t=parseInt(t,10),x.default.findWhere(this.fields,{sort:t})},validateForm:function(){let t=this.$(".js-input"),i=!0;return this.captcha&&!this.formWidget.captchaResponse?!1:(x.default.each(t,function(n){let e=(0,g.default)(n),s=e.val().trim(),o=this.getDataBySort(e.attr("data-sort")),a=!0;if(!s)a=o.optional;else switch(o.tp){case"name":case"text":case"dropdown":break;case"email":M(s)||(a=!1);break;case"phone":/^[0123456789 +-]+$/.test(s)||(a=!1);break;case"number":(!this.NUMBER_TEST_REGEX.test(s)||isNaN(parseFloat(s)))&&(a=!1);break;case"checkbox":!o.optional&&!e.prop("checked")&&(a=!1);break;case"captcha":this.formWidget.captchaResponse||(a=!1);break}a||(this.formWidget.applyInputsStyle(e.closest(".input-wrapper"),{invalid:!0}),i=!1)}.bind(this)),i)},onInput:function(t){let i=(0,g.default)(t.currentTarget).parent().find(".js-input");this.formWidget.applyInputsStyle(i.closest(".input-wrapper")),this.setButtonState()},onInputKeyDown:function(t){t.keyCode===g.default.keycodes.enter&&!(0,g.default)(t.target).is("textarea")&&(t.preventDefault(),this.onButtonClick()),(0,g.default)(t.target).is("textarea")&&(t.keyCode===g.default.keycodes.up||t.keyCode===g.default.keycodes.down)&&t.stopPropagation()},getFormData:function(){let t={wid:this._id,mag_num_id:this.page.mag.num_id,is_preview:!!(RM.constructorRouter&&RM.constructorRouter.preview),fields:[]};return this.captcha&&(t.captcha=this.formWidget.captchaResponse),x.default.each(this.fields,function(i){if(i.tp==="captcha"){t.captcha=this.formWidget.captchaResponse;return}let n=this.$(".js-input[data-sort="+i.sort+"]");if(n.length===0)return;let e=n.val().trim();if(i.tp==="checkbox"&&(e=n.prop("checked")?"On":"Off"),i.tp==="number"){let s=parseFloat(e);e=isNaN(s)?e:s}i.tp!=="file"&&t.fields.push({caption:i.caption,type:i.tp,value:e})}.bind(this)),t},submitForm:function(t){this.xhr&&this.xhr.abort();let i=this.$el.find("form");i.length||(i=this.$el.find(".form-wrapper").wrap('<form enctype="multipart/form-data" method="post" target="form_submit_iframe"></form>').parent().attr("action","/api/connect/forms/send/"+this.page.mag.num_id));let n=new FormData(i.get(0)),e=this.getFormData();if(e&&e.fields)for(let o of e.fields)n.delete(o.name);for(let o of Object.keys(e))n.append(o,typeof e[o]=="object"&&e[o]!==null?JSON.stringify(e[o]):e[o]);let s=n.get("formfiles");s&&(!s.size||!s.name)&&n.delete("formfiles"),this.xhr=g.default.ajax({url:"/api/connect/forms/send/"+this.page.mag.num_id,method:"POST",dataType:"json",data:n,cache:!1,contentType:!1,processData:!1,success:function(){t()},error:function(o){t({status:o.status,responseJSON:o.responseJSON,responseText:o.responseText})}}),RM.analytics&&RM.analytics.sendEvent("form_start")},submitToIframe:function(t){let i=this.endpoint_url&&this.endpoint_url.custom_url,n,e;if(!i)return t("No custom URL specified for submit");n=(0,g.default)("#form_submit_iframe"),n.length||(n=(0,g.default)('<iframe id="form_submit_iframe" name="form_submit_iframe" style="display:none;"></iframe>').appendTo("body")),e=this.$el.find("form"),e.length||(e=this.$el.find(".form-wrapper").wrap('<form method="post" target="form_submit_iframe" enctype="multipart/form-data"></form>')),e.attr("action",i),e.get(0).submit(),t(null),RM.analytics&&RM.analytics.sendEvent("form_start")},setButtonState:function(t){t=t||"";let i=["error","submitted","pending"];this.$button.removeClass(i.join(" ")).addClass(t)}}),ct=Q});export{P as a,z as b,ct as c,tt as d};
