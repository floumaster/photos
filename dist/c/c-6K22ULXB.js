import{a as Ye,b as Ko}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-UR4KCL6S.js";import{a as et,b as tt}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-YCH5UWMY.js";import{a as nt,b as Yo}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-HD4G5GOU.js";import{b as rt,k as Zo}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-5NSADQP4.js";import{c as st,d as it,e as at,f as lt,h as dt,j as gt,o as ct,p as en}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-WKDOY2MT.js";import{a as me,b as Ze}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-2575S5NJ.js";import{a as ot,b as Xo}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-XWPXC4S6.js";import{a as k,b as ue}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-MNE2BWTS.js";import{b as He,e as Qo}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-N5W4XME3.js";import{j as L,m as H,p as Le}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-FGBNWTOM.js";import{B as Pe,C as c,D as S,E as V}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-RNSK6ETS.js";import{a as De}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-GELLX33M.js";import{a as W,b as Y}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-T6VLMN2X.js";import{b as ne,c as qo}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-ZQAKSYJH.js";import{b as Vo}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-ZLNLFSQG.js";import{a as re,c as Qe,j as Xe,n as Jo}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-ICSWQCT7.js";import{b as $o}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-BCAHMXGO.js";import{a as N,d as ce,f as pe}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-AUVFGGVF.js";var Te=N(()=>{"use strict"});function y({children:e}){return c(He,{textStyle:"small",children:e})}function x({children:e}){return c(He,{textStyle:"small",fontStyle:"italic",children:e})}var pt=N(()=>{"use strict";Qo();V()});var G,w,mt,Pt=N(()=>{"use strict";pt();Te();V();G={TextWidget:S(y,{children:["Click on the ",c(x,{children:"plus"})," in the lower-left panel and choose a Text widget"]}),TextWidgetOpenPanel:"Select the text widget to get back on track",PictureWidgetSelect:S(y,{children:["Click on the ",c(x,{children:"plus"})," in the lower-left panel and add a Picture widget"]}),PictureWidgetUse:"Select the picture widget again",ButtonWidgetSelect:S(y,{children:["Click on the plus and choose a ",c(x,{children:"Button"})," widget"]}),ButtonWidgetAdjustVisualProperties:"Select the button widget you added earlier",ButtonWidgetAddLink:"Select the button widget you added earlier",CreateLayout:S(y,{children:["\u0421lick the ",c(x,{children:"Devices"})," icon to add a mobile layout"]}),CreateLayoutSelect:S(y,{children:["\u0421lick the ",c(x,{children:"Devices"})," icon to add a mobile layout"]})},w={TextWidget:S(y,{children:["First, let\u2019s learn how to work with text blocks. Click here to add a ",c(x,{children:"Text"})," widget"]}),TextWidgetOpenPanel:S(y,{children:["Now open the ",c(x,{children:"Typography"})," panel"]}),TextWidgetProperties:"Change the font size to 13 and click on the empty area",TextWidgetSelect:c(y,{children:"Let\u2019s say you want to finish text editing\u2014just click on any empty area"}),TextWidgetDrag:c(y,{children:"Now drag the text to its placeholder (a place reserved for a particular element)"}),PictureWidget:S(y,{children:["You\u2019re off to a good start! Now click on the ",c(x,{children:"plus"})," to start adding a picture"]}),PictureWidgetSelect:S(y,{children:["Choose the ",c(x,{children:"Picture"})," widget"]}),PictureWidgetUse:"Click on the Unsplash icon and pick a picture of a building",PictureWidgetChoose:"Pick a picture building",PictureWidgetClickOutside:"Now let\u2019s align this widget to the grid. Click on the empty area",SelectGrids:S(y,{children:["Then select ",c(x,{children:"Grid & Guides"})]}),ChangeGrids:S(y,{children:["The 3 dots on the right top of the settings correspond to 3 grid presets",c("br",{}),"Click on the last dot"]}),PictureWidgetPlace:"Move the picture to its placeholder and align it to the grid",EverythingInItsRightPlace:"Check that all the added widgets are aligned to the grid and click on empty area",TurnOffGuides:S(y,{children:["Disable the guides by pressing the ",c(x,{children:"H"})," key"]}),PageHeight:S(y,{children:["Now we\u2019ll decrease the page height.",c("br",{}),"Scroll down and drag the ",c(x,{children:"Blue Diamond"})," up"]}),OpenLayersPanel:S(y,{children:["Go to the ",c(x,{children:"Layers"})," panel by pressing ",c(x,{children:"Q"})," to delete placeholders no longer needed"]}),SelectBlocksAndDelete:S(y,{children:["Select widget groups of placeholders and press ",c(x,{children:"Delete"})]}),DeleteBlocks:S(y,{children:["Go to the ",c(x,{children:"Layers"})," panel by pressing ",c(x,{children:"Q"})," and delete no longer needed widget groups of placeholders"]}),ButtonWidget:S(y,{children:["Well done, now let\u2019s add a button. Click on the ",c(x,{children:"plus"})," first"]}),ButtonWidgetSelect:S(y,{children:["Choose a ",c(x,{children:"Button"})," widget"]}),ButtonWidgetAdjustVisualProperties:"Change the button color to black and click on the empty area",ButtonWidgetAddLink:S(y,{children:["Choose an ",c(x,{children:"Anchor"})," type link from the dropdown",c("br",{}),"and add it to the button"]}),ButtonWidgetAddLinkType:S(y,{children:["Add ",c(x,{children:"Anchor"})," link to the button"]}),ButtonWidgetAnchorLinkPosition:"Set the place were the anchor link will lead\u2014above the pictures",ButtonWidgetDrag:"Now drag the button to its placeholder",CreateLayout:S(y,{children:["Now let\u2019s see how your design looks in the mobile version",c("br",{}),"Click on the ",c(x,{children:"Devices"})," icon"]}),CreateLayoutSelect:S(y,{children:["Click on the ",c(x,{children:"plus"})," at the top of the Devices panel"]}),AdjustSizes:"It\u2019s time to add the finishing touch. Swap the picture with the text widget",ArrangeMobile:S(y,{children:["Click ",c(x,{children:"Single column"})," to arrange a mobile version"]}),PreviewAndPublish:S(y,{children:["Last step! Click on the ",c(x,{children:"Eye"})," icon to preview your project before publishing"]}),BackToConstructor:S(y,{children:["Hit ",c(x,{children:"Publish"})," or click the pencil icon to go back to the editor"]})},mt={TextWidget:{name:"TextWidget",text({isPresetPanel:e}={}){return e?S(y,{children:["Open ",c(x,{children:"Widgets"})]}):w.TextWidget},num:1,nextStep:"TextWidgetOpenPanel",widgetSelectionType:"text",fallbackText:G.TextWidget},TextWidgetOpenPanel:{name:"TextWidgetOpenPanel",text:w.TextWidgetOpenPanel,num:2,prevStep:"TextWidget",nextStep:"TextWidgetProperties",fallbackText:G.TextWidgetOpenPanel},TextWidgetProperties:{name:"TextWidgetProperties",text:w.TextWidgetProperties,num:3,prevStep:"TextWidgetOpenPanel",nextStep:"TextWidgetSelect",fallbackText:G.TextWidgetOpenPanel},TextWidgetSelect:{name:"TextWidgetSelect",text:w.TextWidgetSelect,num:4,prevStep:"TextWidgetProperties",nextStep:"TextWidgetDrag"},TextWidgetDrag:{name:"TextWidgetDrag",text:w.TextWidgetDrag,num:5,prevStep:"TextWidgetSelect",nextStep:"ButtonWidget"},ButtonWidget:{name:"ButtonWidget",text:w.ButtonWidget,num:6,prevStep:"TextWidgetDrag",nextStep:"ButtonWidgetSelect"},ButtonWidgetSelect:{name:"ButtonWidgetSelect",text:w.ButtonWidgetSelect,num:7,prevStep:"ButtonWidget",nextStep:"ButtonWidgetDrag",widgetSelectionType:"button",fallbackText:G.ButtonWidgetSelect},ButtonWidgetDrag:{name:"ButtonWidgetDrag",text:w.ButtonWidgetDrag,num:8,prevStep:"ButtonWidgetSelect",nextStep:"ButtonWidgetAdjustVisualProperties"},ButtonWidgetAdjustVisualProperties:{name:"ButtonWidgetAdjustVisualProperties",text:w.ButtonWidgetAdjustVisualProperties,num:9,prevStep:"ButtonWidgetDrag",nextStep:"ButtonWidgetAddLink",fallbackText:G.ButtonWidgetAdjustVisualProperties},ButtonWidgetAddLink:{name:"ButtonWidgetAddLink",text:w.ButtonWidgetAddLink,num:10,prevStep:"ButtonWidgetAdjustVisualProperties",nextStep:"ButtonWidgetAddLinkType",fallbackText:G.ButtonWidgetAddLink},ButtonWidgetAddLinkType:{name:"ButtonWidgetAddLinkType",text:w.ButtonWidgetAddLinkType,num:11,prevStep:"ButtonWidgetAddLink",nextStep:"ButtonWidgetAnchorLinkPosition",fallbackText:G.ButtonWidgetAddLink},ButtonWidgetAnchorLinkPosition:{name:"ButtonWidgetAnchorLinkPosition",text:w.ButtonWidgetAnchorLinkPosition,num:12,prevStep:"ButtonWidgetAddLink",nextStep:"PictureWidget"},PictureWidget:{name:"PictureWidget",text:w.PictureWidget,num:13,prevStep:"ButtonWidgetAddLink",nextStep:"PictureWidgetSelect",widgetSelectionType:"picture"},PictureWidgetSelect:{name:"PictureWidgetSelect",text:w.PictureWidgetSelect,num:14,prevStep:"PictureWidget",nextStep:"PictureWidgetUse",widgetSelectionType:"picture",fallbackText:G.PictureWidgetSelect},PictureWidgetUse:{name:"PictureWidgetUse",text:w.PictureWidgetUse,num:15,prevStep:"PictureWidgetSelect",nextStep:"PictureWidgetChoose",fallbackText:G.PictureWidgetUse},PictureWidgetChoose:{name:"PictureWidgetChoose",text:w.PictureWidgetChoose,num:16,prevStep:"PictureWidgetUse",nextStep:"PictureWidgetClickOutside"},PictureWidgetClickOutside:{name:"PictureWidgetClickOutside",text:w.PictureWidgetClickOutside,num:17,prevStep:"PictureWidgetUse",nextStep:"SelectGrids",fallbackStep:"SelectGrids"},SelectGrids:{name:"SelectGrids",text:w.SelectGrids,num:18,prevStep:"PictureWidgetClickOutside",nextStep:"ChangeGrids"},ChangeGrids:{name:"ChangeGrids",text:w.ChangeGrids,num:19,prevStep:"SelectGrids",nextStep:"PictureWidgetPlace"},PictureWidgetPlace:{name:"PictureWidgetPlace",text:w.PictureWidgetPlace,num:20,prevStep:"ChangeGrids",nextStep:"EverythingInItsRightPlace"},EverythingInItsRightPlace:{name:"EverythingInItsRightPlace",text:w.EverythingInItsRightPlace,num:21,prevStep:"PictureWidgetPlace",nextStep:"TurnOffGuides"},TurnOffGuides:{name:"TurnOffGuides",text:w.TurnOffGuides,num:22,prevStep:"EverythingInItsRightPlace",nextStep:"PageHeight"},PageHeight:{name:"PageHeight",text:w.PageHeight,num:23,prevStep:"TurnOffGuides",nextStep:"OpenLayersPanel"},OpenLayersPanel:{name:"OpenLayersPanel",text:w.OpenLayersPanel,num:24,prevStep:"PageHeight",nextStep:"SelectBlocksAndDelete"},SelectBlocksAndDelete:{name:"SelectBlocksAndDelete",text:w.SelectBlocksAndDelete,num:25,prevStep:"OpenLayersPanel",nextStep:"CreateLayout"},CreateLayout:{name:"CreateLayout",text:w.CreateLayout,num:26,prevStep:"ButtonWidgetAddLink",nextStep:"CreateLayoutSelect",fallbackText:G.CreateLayout},CreateLayoutSelect:{name:"CreateLayoutSelect",text:w.CreateLayoutSelect,num:27,prevStep:"CreateLayout",nextStep:"ArrangeMobile",fallbackText:G.CreateLayoutSelect},ArrangeMobile:{name:"ArrangeMobile",text:w.ArrangeMobile,num:28,prevStep:"CreateLayoutSelect",nextStep:"PreviewAndPublish"},PreviewAndPublish:{name:"PreviewAndPublish",text:w.PreviewAndPublish,num:29,prevStep:"ArrangeMobile",nextStep:"BackToConstructor"},BackToConstructor:{name:"BackToConstructor",text:w.BackToConstructor,num:30,prevStep:"PreviewAndPublish"}}});var he,Tt=N(()=>{"use strict";Te();Pt();he={0:mt}});var ht,ft=N(()=>{"use strict";Y();ht=()=>{W.post("/api/mailchimp/help-tour-not-finished")}});var bt,Ge,on,St,nn,rn,j,Xn,Yn,J,wt,Zn,er,sn,an,tr,or,nr,rr,fe,yt=N(()=>{"use strict";Ze();Le();ue();Tt();Te();ft();Fe();Xo();bt={tourType:0,modalStatus:"unshow",started:!1,waiting:!1,showNotice:!1,step:null,totalSteps:0},Ge=new Set,on=()=>{let e=window.RM.constructorRouter?.me,t=e?.get("behavior_metrics")||{};if(!t||!e)return;let s={...t,constructor_tour_finished:!0};e.save({behavior_metrics:s},{patch:!0})},St=(e,t)=>t?Array.isArray(e)?e.includes(t.name):t.name===e:!1,[nn,rn,j,Xn]=me(bt),Yn=()=>nn({hookType:"layout"}),J=e=>{rn(e),k.trigger("helptour:update",e)},wt=e=>{let t=j();J({...t,modalStatus:e})},Zn=(e=0)=>{let{started:t}=j();if(t)return;let s=Object.values(he[e]),l=s[0];J({tourType:e,modalStatus:"unshow",started:!0,waiting:!1,showNotice:!1,step:l,totalSteps:s.length}),H.sendAmplitudeEvent(L.HelpTour,{status:"started"})},er=()=>{let{started:e}=j();e&&wt("closing")},sn=()=>{let{started:e,step:t,totalSteps:s}=j();if(!e||!t){setTimeout(()=>{window.RM.constructorRouter.trigger("notice:triggerMetrics","helpTourSkipped")},1e3);return}Ge.clear(),J(bt),t?.num<s&&ht()},an=e=>{let{step:t}=j();sn(),wt("end"),e?.(),H.sendAmplitudeEvent(L.HelpTourProgress,{step:t?.num}),H.sendAmplitudeEvent(L.HelpTour,{status:"finished"}),on()},tr=(e,t)=>{let s=j(),{step:l,started:p,tourType:m,totalSteps:d}=s;if(!p)return;if(!l?.nextStep){an(t?.cb);return}let C=(Array.isArray(e)?e:[e]).includes(l.name),M=t?.fallback;if(!C||M&&!l.fallbackStep)return;let _=M&&l.fallbackStep?l.fallbackStep:l.nextStep,b=he[m][_];b&&(J({...s,waiting:!1,showNotice:!1,step:b}),ot(()=>{for(let P=1;P<=d&&!(P>l.num);P++)P<=l.num&&!Ge.has(P)&&(H.sendAmplitudeEvent(L.HelpTourProgress,{step:P}),Ge.add(P))}))},or=e=>{let t=j(),{step:s,started:l,tourType:p}=t;if(!l||!s?.prevStep||!(Array.isArray(e)?e:[e]).includes(s.name))return;let T=he[p][s.prevStep];T&&J({...t,waiting:!1,showNotice:!1,step:T})},nr=e=>{let t=j(),{step:s,started:l}=t;!l||!St(e,s)||J({...t,waiting:!0})},rr=(e,t)=>{let s=j(),{step:l,started:p,showNotice:m}=s;!p||!St(e,l)||J({...s,showNotice:t.show??!m})},fe=()=>j().started});var be,ln,dn,xt=N(()=>{"use strict";be=(e,t,s,l)=>{let p=s.findIndex(C=>C.num===e),m=p>=0?s[p]:null,d=e+1,T=null;if(m&&m.children&&m.children.length)if(l[m._id]&&l[m._id].collapsed)T=m._id;else{let C=s[p+1];C?d=C.num:d=m.children[m.children.length-1].num+1}if(!m){let C=t.find(M=>M.num===e);C&&(T=C.parentPage)}return{newPageNum:d,newPageParentId:T}},ln=(e,t=void 0)=>e.map(s=>s.children?{id:s._id,parentId:t,items:ln(s.children,s._id)}:{id:s._id,parentId:t}),dn=e=>e.reduce((t,s)=>(t.push(s),s.items?t.concat(dn(s.items)):t),[])});var B,vt=N(()=>{"use strict";B=class{constructor({message:t,tag:s,type:l}){pe(this,"message");pe(this,"type");pe(this,"tag");this.message=t,this.tag=s,this.type=l||"error"}}});var Wt,Ct,gr,kt=N(()=>{"use strict";Y();Wt=e=>W.get(`/api/user/${e}/links`),Ct=e=>W.get(`/api/user/${e}/projects-domains`),gr=(e,t)=>W.post("/api/checkdomain",{type:e,domain:t})});var ur,mr,Ot,Pr,Mt=N(()=>{"use strict";Y();ur=()=>W.get("/api/user_templates/"),mr=async()=>{let{data:e}=await W.get("/api/help-tour-template/");return e||{}},Ot=e=>W.delete("/api/template/",{id:e}),Pr=(e,t)=>W.put("/api/template/",{id:e,name:t})});async function br(){return await W.get("/api/domain-reseller")}var At,It,_t,fr,Rt=N(()=>{"use strict";Y();At=({numId:e,domainName:t,domainSource:s})=>W.post("/api/checkdomain",{num_id:e,domain:t,source:s}),It=(e,t)=>W.post(`/api/mag/domain/${e}`,{domain:t,status:"on"}),_t=e=>W.post(`/api/mag/domain/${e}`,{status:"off"}),fr=e=>W.post("/api/domain/visit",{domain:e})});var yr,xr,vr,Wr,Nt,Et,Bt=N(()=>{"use strict";Y();yr=async({email:e,projectNumIds:t,folderIds:s,sharesAll:l,role:p,folderRoles:m,projectRoles:d})=>{let T=await W.post("/api/team",{email:e,mags:t,folders:s,sharesAll:l,role:p,folderRoles:m,projectRoles:d});if(!T.teamMember)throw T.error||T;return T.teamMember},xr=async({email:e,projectNumIds:t,folderIds:s,sharesAll:l,role:p,folderRoles:m,projectRoles:d})=>{let T=await W.put("/api/team",{email:e,mags:t,folders:s,sharesAll:l,role:p,folderRoles:m,projectRoles:d});if(!T.teamMember)throw T.error||T;return T.teamMember},vr=e=>W.delete("/api/team",{email:e}),Wr=e=>W.post("/api/team/invite",{email:e}),Nt=()=>W.get("/api/team"),Et=(e,t={isPending:!1})=>{let s=new URLSearchParams(t);return W.get(`/api/project/${e}/team${s.toString()?"?"+s:""}`)}});function es({project:e,router:t,inPreview:s,children:l}){let p=(0,i.useCallback)(o=>{let n={...o.attributes};return delete n.children,n},[]),[m,d]=(0,i.useState)(()=>{let o=e.pages.models.map(r=>p(r));o.sort((r,a)=>r.num-a.num);let n=we(o,null);return{project:e.attributes,owner:e.user.attributes,isOwner:!!t.isOwner,inPreview:!!s,pages:o,trashPages:[],pageRecentlyDeleted:!1,userTemplates:[],currentPageNum:t.getCurrentPageNum(),currentPageId:t.getCurrentPageId(),pagesTree:n,pagesParams:Se(n,{}),codeInjectUpgradeAlertShown:!1,publishInProgress:!1,unpublishInProgress:!1,isPublishError:!1,selectedPages:[],lockedPages:{},collaborators:[],team:[],allProjects:[],teamworkProjects:[],ownedProjectTeam:[],projectTeam:[],me:t.me.attributes}}),{pages:T,pagesTree:C,pagesParams:M,project:{user:_,opts:b,num_id:P,domain:A},currentPageId:R,currentPageNum:U,publishInProgress:O,unpublishInProgress:E,isOwner:$,me:K}=m,Q=(0,i.useCallback)(o=>{let n=t.pageOrder.get("order"),r=null;if(o>n.length)r=n[n.length-1].id;else{let a=n.find(g=>g.num===o);a&&(r=a.id)}r?t.showWorkspace({id:r}):t.showWorkspace({num:1})},[t]),$e=(0,i.useCallback)((o,n)=>{let r=n.findIndex(a=>a._id===o.get("_id"));if(r>=0){let a=[...n];return a[r]&&(a[r]=p(o)),a}return n},[p]),Z=(0,i.useRef)(void 0),X=(0,i.useCallback)((o,n={})=>{Z.current&&(Z.current.hide(),Z.current.remove()),Z.current=new Ye({$parent:document.querySelector("body > .popups"),router:t,opts:{type:"type-more-pages",is_contributor:!t.isOwner,owner_email:_?_.email:"",...n},alert_source:o}),Z.current.render()},[_,t]),qe=(0,i.useCallback)(()=>{d(o=>({...o,pageRecentlyDeleted:!1}))},[]),ve=(0,i.useRef)(void 0),Je=(0,i.useCallback)(()=>{d(o=>({...o,pageRecentlyDeleted:!0})),ve.current&&clearTimeout(ve.current),ve.current=setTimeout(()=>{qe()},4500)},[qe]),ee=(0,i.useCallback)((o,n)=>e.set(o,n),[e]),ie=(0,i.useCallback)((o,n)=>e.unset(o,n),[e]),Qt=(0,i.useCallback)((o,n)=>e.save(o,n),[e]),Xt=(0,i.useCallback)((o,n,r)=>{let a=e.pages.get(o);if(!a)throw new Error("Element not found");return a.set(n,r)},[e]),Yt=(0,i.useCallback)((o,n,r)=>{let a=e.pages.get(o);if(!a)throw new Error("Element not found");return a.unset(n,r)},[e]),We=(0,i.useCallback)((o,n,r)=>{let a=e.pages.get(o);if(!a)throw new Error("Page not found");return re("constructor.patchPage")?a.save(n,{...r||{},patch:!0}):a.save(n,r)},[e]),Zt=(0,i.useCallback)(o=>{d(n=>({...n,currentPageNum:o}))},[]),Ke=(0,i.useCallback)(o=>{d(n=>({...n,inPreview:o}))},[]),eo=(0,i.useCallback)((o,n)=>{d(r=>({...r,pagesParams:{...r.pagesParams,[o]:{...r.pagesParams[o],collapsed:n}}}))},[]),te=(0,i.useCallback)(async o=>{await e.pages.find(r=>r.attributes._id===o).updateScreenshots(e.get("num_id"))},[e]),to=(0,i.useCallback)((o,n,r)=>new Promise((a,g)=>{let{newPageNum:h,newPageParentId:f}=be(o,T,C,M),v=t.workspace.page.get("order")?.default,F={num:h};n&&(F={...F,...n}),e.addPage(F,ge=>{if(ge&&ge.err)g(ge);else{let D=ge;n?window.RM.constructorRouter.trigger("notice:triggerMetrics","templateUsed"):D.isEmptyPage=!0,D.get("num")===2&&setTimeout(()=>{window.RM.constructorRouter.trigger("notice:triggerEduTip","eduTipUseNavigation",{standAlone:!0})},0),D.set("parentPage",f),t.pageOrder.reorderPagesAfterAdd({page:D,magId:e.get("_id")}),e.onAdd(D),n&&(D.from_template=!0,D.hasGlobalWidgets()&&(e.addGlobalWidgetsFromTemplate(D),e.pages.map(oe=>oe.attributes._id).filter(oe=>oe!==D.id).forEach(oe=>te(oe)))),r||t.showWorkspace({id:D.id}),a(D)}},!0,v)}),[t,e,T,C,M,te]),oo=(0,i.useCallback)(o=>new Promise((n,r)=>{let a=e.getPage(o);if(!a)return r(new Error("Could not find page"));a.get("mid")||a.save({mid:e.get("_id")},re("constructor.patchPage")?{patch:!0,silent:!0}:{silent:!0});let{newPageNum:g,newPageParentId:h}=be(a.get("num"),T,C,M);a.duplicate(f=>{if(f instanceof Error)return f.message==="Server error: permission_denied"&&(ae()?t.trigger("notice:show","unpauseSubscriptionToCreatePage",{canBeClosed:!0}):X("duplicate page",{type:"type-more-pages"})),r(f);let u=f;u.set("parentPage",h),t.pageOrder.reorderPagesAfterAdd({page:u,magId:e.get("_id")}),e.onAdd(u),t.gg.guides?.model&&(t.gg.guides.model.addPage(u.id,{silent:t.gg.guides.hidden}),t.gg.guides.model.save()),t.showWorkspace({id:u.id}),n(f)},{num:g})}),[t,e,T,C,M,X]),no=(0,i.useCallback)(async()=>{let o=t._pageChanged;o&&typeof o=="string"&&(t._pageChanged=!1,await te(o))},[t,te]),ro=(0,i.useCallback)(o=>new Promise((n,r)=>{t.pageOrder.saveInProgress()||(t.pageOrder.save({order:o,mid:t.mag.id},{success:()=>{e.trigger("change:pids",e,e.get("pids")),n()},error:r}),e.trigger("change:pids",e,e.get("pids")))}),[t,e]),so=(0,i.useCallback)(o=>new Promise((n,r)=>{if(t.isPageLocked(o))return r(new Error("This page is locked"));if(e.get("pids").length===1)return r(new Error("Can't delete last page"));let a=M[o],g=[];if(a&&a.children.length){let u=a.children;a.collapsed?t.pageOrder.removeParentIds(u):g=[...u]}if(g.push(o),!e.checkDeletingPages(g))return r(new Error("Can't delete all pages"));let h=g.includes(R),f=U;t.pageOrder.deletePagesFromOrder(g,e.get("_id")).then(()=>{e.deletePages(g,u=>{u instanceof Error?(t.pageOrder.load(e),r(u)):u&&u.deleteNotEmptyPages&&Je(),h?Q(f):t.triggerPageChange(),g.forEach(v=>t.removeWorkspace(v)),n({deleted:g})})},(u,v)=>{r(new Error(v))})}),[t,e,M,R,U,Je,Q]),io=(0,i.useCallback)(o=>new Promise((n,r)=>{e.restorePage(o,{success:a=>{let g=t.workspace.getPageNum();if(!g)throw"Unable to get current page number";let{newPageNum:h,newPageParentId:f}=be(g,T,C,M);a.set("num",h),a.set("parentPage",f),t.pageOrder.reorderPagesAfterAdd({page:a,magId:e.get("_id")}),e.onAdd(a),e.save(),t.showWorkspace({id:a.id}),n(a)},error:a=>{let g=JSON.parse(a.responseText);g.err==="permission_denied"&&X("restore page",{type:"type-more-pages"}),r(g)}},!0)}),[t,e,T,C,M,X]),ao=(0,i.useCallback)(o=>e.deleteTrashPages(o),[e]),lo=(0,i.useCallback)(()=>new Promise(o=>{e.get("has_deleted_pages")?e.fetchTrashPages().then(n=>{n&&d(r=>({...r,trashPages:n})),o(n)}):o([])}),[e]),go=(0,i.useCallback)(()=>e.emptyTrash().then(()=>{d(o=>({...o,trashPages:[]}))}),[e]),co=(0,i.useCallback)(()=>e.loadUserTemplates().then(o=>(Array.isArray(o)&&d(n=>({...n,userTemplates:o})),o)),[e]),po=(0,i.useCallback)(()=>e.hasGlobalWidgets(),[e]),uo=(0,i.useCallback)((o={})=>t.createTemplateFromCurrentPage(o).then(n=>(n&&d(r=>{let a=Array.from(r.userTemplates);return a.unshift(n),{...r,userTemplates:a}}),n)).catch(n=>{throw n&&n.message==="permission denied"&&X("create user template",{type:"type-more-pages"}),n}),[t,X]),mo=(0,i.useCallback)(o=>Ot(o).then(()=>{d(n=>({...n,userTemplates:n.userTemplates.filter(r=>r.id!==o)}))}),[]),Po=(0,i.useCallback)((o,n)=>{let r={hyphen:"The link should not start or end with a hyphen",onlyNumbers:"The link should not consist of digits only",uriLength:"The link should be less than 128 characters long",used:"You already have a page with this link",pageNotFound:"Can't find current page"},a=e.getPage(o);if(a){let g=a.validate({uri:n,parentPage:a.get("parentPage")});return g?r[Object.keys(g)[0]]:void 0}else return r.pageNotFound},[e]),Ce=(0,i.useCallback)(async()=>{let o=e.getUsedFonts({includeCustom:!0,excludeUnusedDefault:!0}),n=nt.sortFontsByProvider(o);return lt(e.id,n,!0)},[e]),To=(0,i.useCallback)(async(o={})=>{let n=e.get("user").permissions||{},r=rt(ne.environment.preview,e.getAllWidgets()),a=K?.plan?.level,g;a==="personal"||a==="freelancer"?g="Please upgrade account to publish another project. Check out the pricing to learn more.":g="Please upgrade your plan to publish more than one project.";let h="Injected Code, Forms, Lottie and Shots will not work in Published project.";if(n.can_publish){if(r&&!n.can_use_e_commerce)throw new B({message:"Please upgrade your account to publish project with ecommerce.",tag:"type-publish-ecommerce"});if(e.hasCodeInjection()&&!t.me?.get("permissions")?.can_inject_code&&!o.skipWarnings)throw new B({message:h,tag:"type-code-injection",type:"warning"});if(e.hasWidgetsWithType("shots")&&!t.me?.get("permissions")?.can_use_shots&&!o.skipWarnings)throw new B({message:h,tag:"type-widget-shots",type:"warning"});if(e.hasWidgetsWithType("lottie")&&!t.me?.get("permissions")?.can_use_lottie&&!o.skipWarnings)throw new B({message:h,tag:"type-widget-lottie",type:"warning"});if(e.hasWidgetsWithType("form")&&!t.me?.get("permissions")?.can_use_forms&&!o.skipWarnings)throw new B({message:h,tag:"type-widget-shots",type:"warning"})}else{let f=n._reasons||{},u=f.can_publish&&f.can_publish.code;throw new B({message:ae()?"You can't publish another project. Your subscription has been paused":u==="reason_publish_limit"?g:"Please verify your email address to publish this project.",tag:ae()?"type-publish-paused-subcription":u==="reason_publish_limit"?"type-publish-limit":"type-publish-noemail"})}if(!O){d(f=>(H.sendAmplitudeEvent(L.Publish,{firstTime:!e.get("is_published"),zone:`editor ${f.inPreview?"preview":"project settings"}`}),{...f,publishInProgress:!0})),o.alsoExport&&_.permissions.can_export_template&&t.exportMagAsTemplateset(o.dontRenewScreenshots);try{await Ce();let f=e.get("num_id"),u=await st(f);e.set({...e.parse(u),changed:!1}),d(v=>({...v,publishInProgress:!1}))}catch{d(u=>({...u,publishInProgress:!1,isPublishError:!0})),await new Promise(u=>setTimeout(u,5e3)),d(u=>({...u,isPublishError:!1}))}}},[t,e,K,_,O,Ce]),ho=(0,i.useCallback)(async()=>{E||(d(o=>({...o,unpublishInProgress:!0})),await at(e.get("num_id")),e.set({is_published:null,published:null,updated:null}),d(o=>({...o,unpublishInProgress:!1})))},[e,E]),fo=(0,i.useCallback)(async()=>{await it(e.get("num_id")),window.location.reload()},[e]),q=(0,i.useCallback)(o=>t.me&&t.me.get("permissions")[o],[t]),ae=(0,i.useCallback)(()=>t.me?.get("permissions")?._reasons?.limited_usage?.code==="reason_subscription_paused",[t]),bo=(0,i.useCallback)(()=>{if(!q("can_export_pdf"))throw new B({message:S(Pe,{children:["Please upgrade your account",c("br",{}),"to export the project to PDF.",c("br",{}),c("a",{href:`${ne.readymag_host}/pricing`,target:"_blank",rel:"noopener noreferrer",className:"learn-more",children:"See the pricing"})]}),tag:"type-export-pdf"})},[q]),So=(0,i.useCallback)(()=>{if(!q("can_export_code"))throw new B({message:S(Pe,{children:["Please upgrade your account",c("br",{}),"in order to export the source",c("br",{}),"code of your projects.",c("br",{}),c("a",{href:`${ne.readymag_host}/pricing`,target:"_blank",rel:"noopener noreferrer",className:"learn-more",children:"See the pricing"}),"."]}),tag:"type-export-code"})},[q]),wo=(0,i.useCallback)(()=>{if(!q("can_use_iframe"))throw new B({message:S(Pe,{children:["Please upgrade your account",c("br",{}),"in order to use iframe",c("br",{}),"for your projects.",c("br",{}),c("a",{href:`${ne.readymag_host}/pricing`,target:"_blank",rel:"noopener noreferrer",className:"learn-more",children:"See the pricing"}),"."]}),tag:"type-iframe-code"})},[q]),yo=(0,i.useCallback)(()=>{t.openCodeEditor()},[t]),xo=(0,i.useCallback)(()=>["ci_head","ci_css","ci_body_top","ci_body_bottom"].some(o=>!!m.project[o]),[m.project]),vo=(0,i.useCallback)(()=>e.hasCodeInjection(),[e]),Wo=(0,i.useCallback)(()=>e.hasWidgetsWithType("shots"),[e]),Co=(0,i.useCallback)(()=>e.hasWidgetsWithType("form"),[e]),ko=(0,i.useCallback)(o=>{d(n=>{let r=n.lastSelectedPage&&n.selectedPages.includes(n.lastSelectedPage)?n.lastSelectedPage:t.getCurrentPageId();if(r){let a=n.pagesTree.reduce((v,F)=>(v.push(F),F.children?[...v,...F.children]:v),[]),g=a.findIndex(v=>v._id===o),h=a.findIndex(v=>v._id===r),f=a.slice(Math.min(g,h),Math.max(g,h)+1).map(v=>v._id).filter(v=>!n.selectedPages.includes(v)),u=[...n.selectedPages,...f];return{...n,selectedPages:u,lastSelectedPage:o}}return{...n,lastSelectedPage:o}})},[t]),Oo=(0,i.useCallback)(o=>{d(n=>{let r=[...n.selectedPages];return r.includes(o)?r.splice(r.indexOf(o),1):r.push(o),{...n,selectedPages:r,lastSelectedPage:o}})},[]),Mo=(0,i.useCallback)(()=>{d(o=>({...o,selectedPages:[]}))},[]),Ao=(0,i.useCallback)(()=>{if(!$)return;let o=t.getCurrentPageId(),n=e.pages.find(r=>r.attributes._id===o);t.unlockPage(n)},[t,e,$]),Io=(0,i.useCallback)(()=>{t.updateUrl(),t.triggerPageChange()},[t]),_o=(0,i.useCallback)(o=>{t.getCurrentPageId()!==o.id&&t.showWorkspace(o)},[t]),ke=(0,i.useCallback)(async o=>{let[n,r]=await Promise.all([Nt(),Et(o,{})]),{mags:a}=await W.get("/api/readymags/user");return{team:n,allProjects:a,teamworkProjects:a.filter(g=>g.num_id===o),ownedProjectTeam:n.filter(g=>g.projectNumIds.includes(o)),projectTeam:r}},[]),Ro=(0,i.useCallback)((o,n)=>{d(r=>({...r,team:o,ownedProjectTeam:o.filter(a=>a.projectNumIds.includes(n))}))},[]),No=(0,i.useCallback)(o=>{let n=o||(t.me?t.me.get("_id"):"");return Wt(n)},[t]),Eo=(0,i.useCallback)(o=>{let n=o||(t.me?t.me.get("_id"):"");return Ct(n)},[t]),Bo=(0,i.useCallback)(o=>dt({...o,numId:o.numId?o.numId:e.get("num_id")}).then(()=>{let{isPrivate:n,isPrivatePages:r,password:a}=o;e.set({is_private:n,isPrivatePages:r,pass:a!==void 0?a:e.get("pass")})}),[e]),Uo=(0,i.useCallback)((o,n)=>{let r=We(o,{isPrivate:n},{patch:!0});r&&!(r instanceof Error)&&r.done(()=>{let a=(g,h,f)=>g.map(u=>(u._id===h&&(u.isPrivate=f),u));d(g=>{let h=a(g.pages,o,n),f=g.pagesTree.map(u=>(u._id===o&&(u.isPrivate=n),u.children&&u.children.length&&(u.children=a(u.children,o,n)),u));return{...g,pages:h,pagesTree:f,pagesParams:Se(f,g.pagesParams)}})})},[We]),Do=(0,i.useCallback)(o=>{let n=_.permissions.viewer_opts_overrides||{},a={...e.get("opts"),...o==="phone_portrait"?e.get("viewport_phone_portrait")?.opts||{}:o==="tablet_portrait"?e.get("viewport_tablet_portrait")?.opts||{}:{},...n};return{...a,...e.get("is_private")&&{sharebutton:!1},...!a.menubutton&&{projectinfo:!1}}},[e,_]),le=(0,i.useCallback)((o,n,r)=>{let a=je.default.intersection(Object.keys(o),Xe).length>0,g=r==="phone_portrait"||r==="tablet_portrait",h=a&&g?r:"default",f=Object.keys(o)[0],u={...o,...o.menubutton===!1&&{projectinfo:!1}};if(["arrows","menubutton","projectinfo","sharebutton","pagecounter","controlsontop","controlsontop","branding","slidein","scalableviewer"].includes(f)&&f==="scalableviewer"&&H.sendAmplitudeEvent(L.SettingsViewer,{settingsType:"scale layout"}),h==="phone_portrait"||h==="tablet_portrait"){let v=`viewport_${h}`,F={...e.get(v)?.opts||{},...u};return e.set(v,{...e.get(v)||{},opts:F},n),Ut(e.get("num_id"),F,h)}else{let v={...e.get("opts"),...u};return e.set("opts",v,n),Ut(e.get("num_id"),v,h)}},[e,b]),Lo=(0,i.useCallback)((o,n)=>At({numId:P,domainName:o,domainSource:n}).then(r=>(ee({last_checked_domain:o,last_checked_domain_source:n},{silent:!0}),r)),[P,ee]),Ho=(0,i.useCallback)(o=>It(P,o).then(()=>{ee({domain:o,domainStatus:"on"})}),[P,ee]),Go=(0,i.useCallback)(()=>_t(P).then(o=>(ie("domain"),ie("domainStatus"),o)),[e,A,P,b,ie,le]),Oe=(0,i.useCallback)((o,n)=>{o&&d(r=>{let a=o.pages.models.map(h=>p(h)).filter(h=>n.includes(h._id));a.sort((h,f)=>h.num-f.num);let g=we(a,null);return{...r,project:o.attributes,pages:a,pagesTree:g,pagesParams:Se(g,r.pagesParams)}})},[p]),Me=(0,i.useCallback)(o=>{o&&d(n=>({...n,project:o.attributes}))},[]),Ae=(0,i.useCallback)((o,n,r)=>{o&&(o.changed&&!r?.socketUpdate&&(o.changed.num||o.changed.parentPage)||d(a=>{let g=$e(o,a.pages);g.sort((f,u)=>f.num-u.num);let h=we(g,null);return{...a,pages:g,pagesTree:h,pagesParams:Se(h,a.pagesParams)}}))},[$e]),Ie=(0,i.useCallback)(o=>{o&&d(n=>{let r=Array.from(n.trashPages);return r.unshift(o.attributes),{...n,trashPages:r}})},[]),_e=(0,i.useCallback)(o=>{o&&d(n=>{let r=Array.from(n.trashPages),a=r.findIndex(g=>g._id===o.get("_id"));return a>-1&&r.splice(a,1),{...n,trashPages:r}})},[]);(0,i.useEffect)(()=>{function o(){ke(e.attributes.num_id).then(n=>{d(r=>({...r,...n}))})}return o(),e.on(Dt(),Me),e.on("change:pids",Oe),e.pages.on(Lt(),Ae),e.trashPages.on("add",Ie),e.trashPages.on("remove",_e),k.on("refreshTeamworkData",o),()=>{e.off(Dt(),Me),e.off("change:pids",Oe),e.pages.off(Lt(),Ae),e.trashPages.off("add",Ie),e.trashPages.off("remove",_e),k.off("refreshTeamworkData",o)}},[e,Me,Oe,Ie,_e,Ae,ke]);let Re=(0,i.useCallback)(o=>Ke(o),[]);(0,i.useEffect)(()=>(t.on("togglePreview",Re),()=>{t.off("togglePreview",Re)}),[t,Re]);let Ne=(0,i.useCallback)(o=>{let n=o.getPageNum(),r=o.getPageId();n&&r&&d(a=>({...a,currentPageNum:n,currentPageId:r}))},[]);(0,i.useEffect)(()=>(t.on("pageChange",Ne),()=>{t.off("pageChange",Ne)}),[t,Ne]);let de=(0,i.useCallback)(o=>{d(n=>({...n,currentPageNum:o.num,currentPageId:o._id}))},[]);(0,i.useEffect)(()=>(m.inPreview?t.on("previewPageChange",de):t.off("previewPageChange",de),()=>{t.off("previewPageChange",de)}),[m.inPreview,t,de]);let Ee=(0,i.useCallback)((o,n)=>{d(r=>({...r,lockedPages:{...r.lockedPages,[o]:n}}))},[]),Be=(0,i.useCallback)(o=>{d(n=>{let{[o]:r,...a}=n.lockedPages;return{...n,lockedPages:a}})},[]),Ue=(0,i.useCallback)(({list:o})=>{d(n=>({...n,collaborators:o||[]}))},[]);(0,i.useEffect)(()=>(k.on("page:locked",Ee),k.on("page:unlocked",Be),k.on("sockets:connect",Ue),()=>{k.off("page:locked",Ee),k.off("page:unlocked",Be),k.off("sockets:connect",Ue)}),[Ee,Be,Ue]),(0,i.useEffect)(()=>{b.branding===void 0&&le({branding:b.endpage})},[b,le]);let Fo=(0,i.useCallback)(o=>{let n=m.project.user.permissions.viewer_opts_overrides||{};return{disabled:[...Object.keys(n),...o?.menubutton?[]:["projectinfo"],...m.project.is_private?["sharebutton"]:[],...m.project.user.permissions.must_show_branding?["branding"]:[]],permissionOverrides:n}},[m.project]),jo=(0,i.useCallback)(async(o,n)=>{await ct(o,n),d(r=>({...r,project:{...r.project,allow_iframe_embed:o==="allow"}}))},[]),zo={projectSet:ee,projectUnset:ie,projectSave:Qt,pageSet:Xt,pageUnset:Yt,pageSave:We,setCurrentPageNum:Zt,setInPreview:Ke,setPageCollapse:eo,addNewPage:to,duplicatePage:oo,renewLastScreenshot:no,updatePageScreenshot:te,restorePage:io,saveOrder:ro,deletePage:so,deletePagesFromTrash:ao,updateTrash:lo,emptyTrash:go,getUserTemplates:co,hasGlobalWidgets:po,createTemplateFromCurrentPage:uo,deleteUserTemplate:mo,validatePageUri:Po,updateUsedFonts:Ce,publishWithNotice:To,unpublish:ho,restoreToPublished:fo,checkPDFExportPermission:bo,checkHTMLExportPermission:So,checkIFrameExportPermission:wo,openCodeEditor:yo,hasProjectCode:xo,hasCustomCode:vo,hasShots:Wo,hasForms:Co,hasPermission:q,isSubscriptionPaused:ae,selectPage:Oo,selectPagesRange:ko,deselectPages:Mo,takeOverCurrentPage:Ao,updateUrl:Io,changeWorkspace:_o,loadTeamworkData:ke,updateTeam:Ro,getProjectOptions:Do,setProjectOptions:le,loadUserProjectsLinks:No,getDomainsAmount:Eo,setPrivacy:Bo,setPageIsPrivate:Uo,checkDomain:Lo,mapDomain:Ho,unmapDomain:Go,getProjectPermissionsOverrides:Fo,toggleAllowIframeEmbed:jo};return c(Ht.Provider,{value:{...m,...zo,projectMag:e},children:l})}var i,je,Ht,Ut,we,Se,Dt,Lt,ts,Gt=N(()=>{"use strict";i=ce(De());Le();je=ce(Vo());xt();Y();Ko();Yo();Zo();qo();ue();$o();vt();Jo();en();kt();Mt();Rt();Bt();tt();Fe();Qe();V();Ht=(0,i.createContext)({}),Ut=je.default.throttle(gt,300),we=(e,t)=>{let s=[];for(let l in e)if(e[l].parentPage===t){let p=we(e,e[l]._id),m=Object.assign({},e[l]);p.length&&(m.children=p),s.push(m)}else if(e[l].parentPage===void 0){let p=Object.assign({},e[l]);s.push(p)}return s},Se=(e,t)=>{let s={};return e.forEach((l,p)=>{if(s[l._id]={collapsed:t[l._id]?t[l._id].collapsed:!0,viewNum:p+1,uri:l.uri?l.uri:(p+1).toString(),children:[]},l.children){let m=[];l.children.forEach((d,T)=>{m.push(d._id),s[d._id]={collapsed:t[d._id]?t[d._id].collapsed:!0,viewNum:T+1,uri:d.uri?d.uri:(T+1).toString(),children:[],parentId:l._id}}),s[l._id].children=m}}),s},Dt=()=>["title","description","user","folder","uri","domain","domainStatus","last_checked_domain","has_deleted_pages","master_share_pid","changed","is_published","is_private","isPrivatePages","pass","pass_bg","published","opts","viewport_phone_portrait","viewport_tablet_portrait"].map(t=>`change:${t}`).join(" "),Lt=()=>["num","parentPage","screenshot","viewport_phone_portrait","viewport_tablet_portrait","title","uri","seo","hidden","custom_shares"].map(t=>`change:${t}`).join(" ");ts=()=>(0,i.useContext)(Ht)});var ze=N(()=>{"use strict"});function Ps({magModel:e,router:t,children:s}){let[l,p]=(0,I.useReducer)(un,{router:t,magModel:e},cn),m=(0,I.useCallback)(({pageNumber:P,scrollTop:A}={})=>{let R=t.workspace?.page.get("num");window.RM.constructorRouter.togglePreview({pageNumber:P??R,scrollTop:A}),l.inPreview||window.RM.constructorRouter.trigger("notice:triggerEduTipClose")},[t]);(0,I.useEffect)(()=>{let P=()=>{p({type:"togglePreview"})};return window.RM.constructorRouter.unbindGlobalKeyPress("p",m),window.RM.constructorRouter.bindGlobalKeyPress({key:"p",handler:m}),l.inPreview?(window.RM.constructorRouter.off("previewOpen",P),window.RM.constructorRouter.on("previewClose",P)):(window.RM.constructorRouter.off("previewClose",P),window.RM.constructorRouter.on("previewOpen",P)),()=>{window.RM.constructorRouter.unbindGlobalKeyPress("p",m),window.RM.constructorRouter.off("previewOpen",P),window.RM.constructorRouter.off("previewClose",P)}},[l.inPreview]),(0,I.useEffect)(()=>{localStorage.setItem(Ft,JSON.stringify({gridSize:l.gridSize}))},[l.gridSize]);let d=(0,I.useCallback)(()=>{p({type:"openMagMenu"})},[]),T=(0,I.useCallback)(()=>{p({type:"closeMagMenu"})},[]),C=(0,I.useCallback)((P,A)=>{A.viewertype!==l.magMenuOrientation&&p({type:"setMagMenuOrientation",orientation:A.viewertype}),A.menubutton!==l.magMenuOn&&p({type:"setMagMenu",isOn:A.menubutton}),A.controlsontop!==l.controlsOnTop&&p({type:"setControlsOnTop",onTop:A.controlsontop})},[l.magMenuOrientation,l.magMenuOn,l.controlsOnTop]);(0,I.useEffect)(()=>(k.on("magMenu:open",d),k.on("magMenu:close",T),()=>{k.off("magMenu:open",d),k.off("magMenu:close",T)}),[d,T]),(0,I.useEffect)(()=>(k.listenTo(e,"change:opts",C),()=>{k.stopListening(e,"change:opts",C)}),[C]);let M=(0,I.useCallback)(()=>{p({type:"setReadyToPublish",ready:!0})},[]);(0,I.useEffect)(()=>(k.listenTo(t,"previewMag:load:success",M),()=>{k.stopListening(t,"previewMag:load:success",M)}),[M]);let _=()=>{p({type:"toggleCartSidebarState"})};(0,I.useEffect)(()=>(k.on("ecommerce:cartsidebar:visibility:changed",_),()=>{k.off("ecommerce:cartsidebar:visibility:changed",_)}),[_]);let b=(P,A)=>new Promise((R,U)=>{let O=e.getPage(P);O||R(null),O.save({hidden:A}).done(E=>{R(E)}).fail(E=>{U(E.responseJSON)})});return c(ye.Provider,{value:{...l,dispatch:p,setPageVisibility:b,togglePreview:m},children:s})}var I,ye,Ft,jt,cn,pn,un,Ts,zt=N(()=>{"use strict";I=ce(De());ze();ue();V();ye=(0,I.createContext)({}),Ft="rm_pageSettings",jt={};try{let e=localStorage.getItem(Ft);jt=JSON.parse(e||"{}")}catch{}cn=({router:e,magModel:t})=>({inPreview:!!e.previewMode,isMagMenuOpen:!1,isTrashOpened:!1,isPageSettingsOpened:!1,isPrivatePagesOpened:!1,isHelpPopupOpened:!1,isUserTemplatesModalShown:!1,isRmTemplatesModalShown:!1,isPageActionsPopupOpenedFor:!1,gridSize:jt.gridSize||0,selectedPages:{},isDragging:!1,magMenuOrientation:t.attributes.opts.viewertype,magMenuOn:t.attributes.opts.menubutton,controlsOnTop:t.attributes.opts.controlsontop,readyToPublish:!0,addingPage:!1,isTeamworkModalOpened:!1,exportAsTemlate:!1,dontRenewScreenshots:!1,showTourOnOpen:!!e.showTourOnOpen,helpTourIsFinished:!!e.helpTourIsFinished,isCartSidebarOpened:!1,showTips:!!e.me?.attributes.constructor_show_tips,masterSharePidIsChanging:!1}),pn=(e,t)=>{let s={...e.selectedPages};return s[t]?delete s[t]:s[t]=!0,s},un=(e,t)=>{switch(t.type){case"togglePreview":{let s=!e.inPreview;return{...e,inPreview:s,readyToPublish:s?!1:e.readyToPublish,notice:void 0}}case"openMagMenu":return{...e,isMagMenuOpen:!0};case"closeMagMenu":return{...e,isMagMenuOpen:!1};case"setMagMenuOrientation":return{...e,magMenuOrientation:t.orientation};case"setMagMenu":return{...e,magMenuOn:t.isOn};case"setControlsOnTop":return{...e,controlsOnTop:t.onTop};case"toggleTrash":return{...e,isTrashOpened:!e.isTrashOpened};case"togglePageSettings":return{...e,isPageSettingsOpened:!e.isPageSettingsOpened,isHelpPanelOpen:!1};case"togglePrivatePages":return{...e,isPrivatePagesOpened:t.payload?!0:!e.isPrivatePagesOpened,privatePageSelected:t.payload};case"toggleHelpPopup":return{...e,isHelpPopupOpened:!e.isHelpPopupOpened};case"toggleHelpTourIsFinished":return{...e,helpTourIsFinished:t.finished};case"toggleUserTemplatesModal":return{...e,isUserTemplatesModalShown:!e.isUserTemplatesModalShown};case"toggleRmTemplatesModal":return{...e,isRmTemplatesModalShown:!e.isRmTemplatesModalShown};case"setPageActionsPopup":return{...e,isPageActionsPopupOpenedFor:t.payload};case"toggleGridSize":return{...e,gridSize:e.gridSize===0?1:0};case"togglePageSelection":return{...e,selectedPages:pn(e,t.payload)};case"setDragging":return{...e,isDragging:t.payload};case"setReadyToPublish":return{...e,readyToPublish:t.ready};case"setAddingPage":return{...e,addingPage:t.inProgress};case"toggleTeamworkModal":return{...e,isTeamworkModalOpened:t.payload};case"toggleExportAsTemlate":return{...e,exportAsTemlate:!e.exportAsTemlate};case"toggleDontRenewScreenshots":return{...e,dontRenewScreenshots:!e.dontRenewScreenshots};case"toggleShowTourOnOpen":return{...e,showTourOnOpen:t.showOnOpen};case"toggleCartSidebarState":return{...e,isCartSidebarOpened:!e.isCartSidebarOpened};case"toggleShowTips":return{...e,showTips:!e.showTips};case"toggleMasterSharePidChanging":return{...e,masterSharePidIsChanging:!e.masterSharePidIsChanging};default:return e}};Ts=()=>(0,I.useContext)(ye)});var Vt=N(()=>{"use strict";Gt();zt();ze()});function Is(){let e=yn(),t=(0,se.useContext)(ye);(0,se.useEffect)(()=>{typeof window<"u"&&window.RM&&z({...e,router:window.RM.constructorRouter,isSmartTip:$t})},[]);let[{router:s,isSmartTip:l}]=wn(),p=(b,P={})=>{fe()||(P.closeByTimer&&(delete P.closeByTimer,setTimeout(()=>{z(e.visible?{...e,visible:!1}:e)},qt)),z({...e,...P,message:b,needShowHelpIcon:!1,visible:!0,isTipType:!1}))},m=b=>{z({...e,message:b})},d=(b,P={})=>{if(fe()||!s||!s.me||!t.showTips||l&&!Kt(b)||!l&&Kt(b))return;let R=(s.me.get("edu_tips_state")||{})[b]||0,U=()=>{e.visible&&(xe(b,2,s),z({...e,visible:!1}))};if(P.closeByTimer)delete P.closeByTimer,setTimeout(U,qt);else if(l){setTimeout(U,mn);let O=Tn(b);O&&xe(O,3,s)}switch(R){case 3:break;case 2:if(P.showOnce)break;z({...e,visible:!0,message:b,canBeClosed:!0,needShowHelpIcon:!0,isTipType:!0,standAlone:P.standAlone});break;case 0:{if(xe(b,2,s),Pn.includes(b)&&k.trigger("tips:show",b),l){let O=bn(b);O&&H.sendAmplitudeEvent(L.EditorTips2,{tip:O})}else{let O=fn(b);O&&H.sendAmplitudeEvent(L.EditorTips,{tip:O})}z({...e,visible:!0,message:b,canBeClosed:!0,needShowHelpIcon:!0,isTipType:!0,standAlone:P.standAlone})}}},T=()=>{e.visible&&e.message&&(xe(e.message,3,s),z({...e,visible:!1}))},C=()=>{e.visible&&z({...e,visible:!1})},M=(b,P)=>{if(!s||!s.me||!s.me.get("constructor_show_tips")||fe()||!t.showTips)return;let A=hn(b,P,s),R=s.me.get("edu_tips_state")||{},U=(O,E)=>{if(!O||!E)return!1;for(let $ in E)if(E.hasOwnProperty($)){let K=O?.[$],Q=E[$];if(typeof Q=="number"&&typeof K=="number"&&Q>K||Q!==K)return!1}return!0};for(let O in Ve)if(Ve.hasOwnProperty(O)&&!R[O]){let E=Ve[O];(typeof E=="function"?E(A):U(A,E))&&d(O,{showOnce:!0})}},_=({id:b,color:P})=>{if(!l||!s||!s.me||!$t)return;let A=s.me.get("behavior_metrics")||{},R=A.triggeredColors||{};if(b in R)R[b]=P;else{for(let U of Object.values(R))U===P&&d("eduTipUseColorPalette");R[b]=P,A.triggeredColors=R,s.me.save({behavior_metrics:A},{patch:!0})}};return(0,se.useEffect)(()=>{if(s)return s.on("notice:show",p),s.on("notice:hide",C),s.on("notice:triggerEduTip",d),s.on("notice:triggerEduTipClose",T),s.on("notice:triggerMetrics",M),s.on("notice:triggerColorMetrics",_),()=>{s.off("notice:show",p),s.off("notice:hide",C),s.off("notice:triggerEduTip",d),s.off("notice:triggerEduTipClose",T),s.off("notice:triggerMetrics",M),s.off("notice:triggerColorMetrics",_)}},[s,e]),{showNotice:p,setNoticeMessage:m,triggerEduTip:d,triggerEduTipClose:T,hideNotice:C,triggerMetrics:M,triggerColorMetrics:_}}var se,$t,Ve,qt,mn,Pn,Jt,Tn,xe,hn,fn,bn,Kt,Sn,wn,z,yn,Fe=N(()=>{"use strict";se=ce(De());Le();Ze();ue();tt();yt();Vt();Qe();$t=re("constructor.smartTips"),Ve={eduTipUseViewportsIcon:{viewportIconHovered:!0},eduTipOnDeleteMobileWidget:{widgetDeletedOnMobile:!0},eduTipUseBundleDragTriangle:{bundleDragHovered:!0},eduTipUseShortcutToChangeSizes:{widgetSlightlyResized:!0},eduTipUseShortcutToMoveText:{countTextWidgetCreated:9},eduTipUseShortcutToCopyAnimation:{countAnimatedWidgetCreated:2},eduTipUseShortcutToEnableGuides:{countWidgetCreated:3,guidesTurnOn:void 0},eduTipUseShortcutToEnableSizes:{widgetResized:!0,sizesToolTurnOn:void 0},eduTipUseFix:{countWidgetCreated:10,fixedWidgetUsed:void 0},eduTipUseAbovePages:{countFixedWidgetCreated:3,onAllPagesWidgetUsed:void 0},eduTipUsePlusIcon:{helpTourSkipped:!0},eduTipUseWidgetSettings:{helpTourSkipped:!0,countWidgetCreated:1},eduTipUseBlocks:{secondWidgetMoved:!0},eduTipUseTextStylesWidget:{templateUsed:void 0,countTextWidgetCreated:3},eduTipUseTextStylesControl:{templateUsed:void 0,textWidgetCopied:!0},eduTipUseColorPalette:{sameColorUsed:!0,templateUsed:void 0},eduTipUseArrangeControl:{mobileGroupSelected:!0},eduTipUseGroupEditing:{multipleWidgetsOfSameTypeSelected:!0}},qt=6e3,mn=15e3,Pn=["eduTipUseWidgetSettings","eduTipUseTextStylesControl","eduTipUseColorPalette","eduTipUseArrangeControl"],Jt=[["eduTipUseTextStylesWidget","eduTipUseTextStylesControl"]],Tn=e=>{for(let t=0;t<Jt.length;t++){let s=Jt[t];if(s.includes(e))return s.find(l=>l!==e)}return!1},xe=(e,t,s)=>{let l=s?.me;if(!l)return;let p=l.get("edu_tips_state")||{};p[e]=t,l.save({edu_tips_state:p},{patch:!0})},hn=(e,t,s)=>{let l=s?.me;if(!l)return{};let p=l.get("behavior_metrics")||{},m=e.includes("count"),d=p[e];return m&&t===void 0?p[e]=typeof d=="number"?d+1:1:p[e]=t===void 0?!0:t,l.save({behavior_metrics:p},{patch:!0}),p},fn=e=>{switch(e){case"eduTipUseCommentsMode":return"comments for collaborators";case"eduTipUseShortcutToEnableGuides":return"guides shortcut";default:return!1}},bn=e=>{switch(e){case"eduTipUsePlusIcon":return"plus icon";case"eduTipUseWidgetSettings":return"widget settings";case"eduTipUseBlocks":return"distance between blocks";case"eduTipUseNavigation":return"horizontal vertical navigation";case"eduTipUseColorPalette":return"palette";case"eduTipUseTextStylesWidget":return"text styles";case"eduTipUseTextStylesControl":return"text styles";case"eduTipUseOnboarding":return"beginners onboarding kit";case"eduTipUseArrangeControl":return"arrange";default:return!1}},Kt=e=>!!Object.values(et).includes(e),Sn={message:"",visible:!1,canBeClosed:!0,needShowHelpIcon:!1,isTipType:!1,router:null},[wn,z,yn]=me(Sn)});export{Tt as a,ln as b,dn as c,xt as d,B as e,vt as f,gr as g,kt as h,ur as i,mr as j,Pr as k,Mt as l,fr as m,br as n,Rt as o,yr as p,xr as q,vr as r,Wr as s,Bt as t,Ht as u,es as v,ts as w,ye as x,Ps as y,Ts as z,Vt as A,Pn as B,wn as C,yn as D,Is as E,Fe as F,j as G,Yn as H,wt as I,Zn as J,er as K,sn as L,tr as M,or as N,nr as O,rr as P,fe as Q,yt as R};
