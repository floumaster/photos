import{a as Y,b as _t}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-3JTKMXCP.js";import{a as A,b as ft}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-7ISZFS5L.js";import{d as Z,e as pt}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-AWS5ECR2.js";import{d as W,e as dt}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-WG7TXOCY.js";import{a as F,b as ot}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-ZER6KXXX.js";import{Bb as ct,P as G,Q as V,R as lt,pb as O,qb as q}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-LEKR5NMI.js";import{d as H,e as R,g as ht}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-YL3EVUGU.js";import{a as k,b as ut}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-LBVH3I4Y.js";import{a as y,b as gt}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-UCHF6G32.js";import{a as v,b as nt}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-DLSH5BZK.js";import{c as M,d as rt}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-BWWKPZRF.js";import{a as it}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-C76PJ5AO.js";import{n as X,o as mt}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-3SL2HRH4.js";import{a as at}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-3QPOSLGL.js";import{C as x,E as z}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-RNSK6ETS.js";import{b as N,c as st}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-ZQAKSYJH.js";import{a as E}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-5UYOLCPY.js";import{b as B}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-ZLNLFSQG.js";import{a as $,b as et}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-ZGXQUP27.js";import{a as U,d as b}from"https://st-p.rmcdn.net/8e59565c/dist/c/c-AUVFGGVF.js";var j,K=U(()=>{"use strict";ot();j={"template-common-slideshow-player":F`
	<div class="common-slideshow <%- newSlideshowCaptions ? 'common-slideshow-v2' : ''%> environment-<%-tp%>">
		<div class="images no-rmswipe">
			<div class="images-wrapper">
			</div>
			<div class="fullscreen">
				<svg class="fullscreen-off" width="17px" height="17px" viewBox="0 0 17 17" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
					<g id="Page-1" stroke="none" stroke-width="0.1" fill="none" fill-rule="evenodd">
						<g id="full-screen" transform="translate(-12.000000, -12.000000)" fill="#F4F4F4" fill-rule="nonzero">
							<g id="Arrows" transform="translate(12.000000, 12.000000)">
								<path d="M12.7571068,4.74264069 L10.2571068,7.24264069 C9.86658249,7.63316498 9.23341751,7.63316498 8.84289322,7.24264069 C8.45236893,6.8521164 8.45236893,6.21895142 8.84289322,5.82842712 L11.3428932,3.32842712 L9.72157288,1.70710678 C9.33104858,1.31658249 9.33104858,0.683417511 9.72157288,0.292893219 C9.90910925,0.10535684 10.1634632,-2.93098879e-14 10.4286797,-2.93098879e-14 L15.0144661,-2.93098879e-14 C15.5667508,-2.93098879e-14 16.0144661,0.44771525 16.0144661,1 L16.0144661,5.58578644 C16.0144661,6.13807119 15.5667508,6.58578644 15.0144661,6.58578644 C14.7492496,6.58578644 14.4948957,6.4804296 14.3073593,6.29289322 L12.7571068,4.74264069 Z" id="Combined-Shape"></path>
								<path d="M4.20710669,13.2426408 L1.70710669,15.7426408 C1.3165824,16.1331651 0.683417421,16.1331651 0.292893129,15.7426408 C-0.097631163,15.3521165 -0.097631163,14.7189515 0.292893129,14.3284272 L2.79289313,11.8284272 L1.17157279,10.2071069 C0.781048494,9.81658256 0.781048494,9.18341758 1.17157279,8.79289329 C1.35910916,8.60535691 1.61346308,8.50000007 1.87867957,8.50000007 L6.464466,8.50000007 C7.01675075,8.50000007 7.464466,8.94771532 7.464466,9.50000007 L7.464466,14.0857865 C7.464466,14.6380713 7.01675075,15.0857865 6.464466,15.0857865 C6.19924951,15.0857865 5.9448956,14.9804297 5.75735922,14.7928933 L4.20710669,13.2426408 Z" id="Combined-Shape" transform="translate(3.732233, 12.267767) rotate(180.000000) translate(-3.732233, -12.267767) "></path>
							</g>
						</g>
					</g>
				</svg>
				<svg class="fullscreen-on" width="18px" height="18px" viewBox="0 0 18 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
					<g id="Page-1" stroke="none" stroke-width="0.1" fill="none" fill-rule="evenodd">
						<g id="full-screen" transform="translate(-11.000000, -11.000000)" fill="#F4F4F4" fill-rule="nonzero">
							<g id="Arrows" transform="translate(11.000000, 11.000000)">
								<path d="M14.2071067,5.24264078 L11.7071067,7.74264078 C11.3165824,8.13316507 10.6834174,8.13316507 10.2928931,7.74264078 C9.90236883,7.35211649 9.90236883,6.71895151 10.2928931,6.32842721 L12.7928931,3.82842721 L11.1715728,2.20710687 C10.7810485,1.81658258 10.7810485,1.1834176 11.1715728,0.792893312 C11.3591092,0.605356933 11.6134631,0.500000093 11.8786796,0.500000093 L16.464466,0.500000093 C17.0167507,0.500000093 17.464466,0.947715343 17.464466,1.50000009 L17.464466,6.08578653 C17.464466,6.63807128 17.0167507,7.08578653 16.464466,7.08578653 C16.1992495,7.08578653 15.9448956,6.98042969 15.7573592,6.79289331 L14.2071067,5.24264078 Z" id="Combined-Shape" transform="translate(13.732233, 4.267767) rotate(180.000000) translate(-13.732233, -4.267767) "></path>
								<path d="M4.70710678,14.7426407 L2.20710678,17.2426407 C1.81658249,17.633165 1.18341751,17.633165 0.792893219,17.2426407 C0.402368927,16.8521164 0.402368927,16.2189514 0.792893219,15.8284271 L3.29289322,13.3284271 L1.67157288,11.7071068 C1.28104858,11.3165825 1.28104858,10.6834175 1.67157288,10.2928932 C1.85910925,10.1053568 2.11346317,10 2.37867966,10 L6.96446609,10 C7.51675084,10 7.96446609,10.4477153 7.96446609,11 L7.96446609,15.5857864 C7.96446609,16.1380712 7.51675084,16.5857864 6.96446609,16.5857864 C6.6992496,16.5857864 6.44489569,16.4804296 6.25735931,16.2928932 L4.70710678,14.7426407 Z" id="Combined-Shape"></path>
							</g>
						</g>
					</g>
				</svg>
			</div>

			<div class="bottom-arrows">
					<div class="prev-picture-arrow-bottom arrow-bottom">
						<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="40" height="40">
							<path d="M23.5 11.5 L15.5 19.5 L23.5 27.5" stroke-linejoin="round" stroke-linecap="round" style="fill:none; stroke:#ffffff; stroke-width:3px"></path>
						</svg>
					</div>

					<div class="counters-container">
						<div class="counters-numbers">
							<span class="counters-text-current">1</span>/<span class="counters-text-total">2</span>
						</div>

						<div class="counters-dots no-rmswipe">
							<div class="scroll-wrapper">
								<div class="items-wrapper has-horizontal-scroll">
									<div class="items">
									</div>
								</div>
								<div class="scroll"></div>
							</div>
						</div>
					</div>

					<div class="next-picture-arrow-bottom arrow-bottom">
						<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="40" height="40">
							<path d="M16.5 11.5 L24.5 19.5 L16.5 27.5" stroke-linejoin="round" stroke-linecap="round" style="fill:none; stroke:#ffffff; stroke-width:3px"></path>
						</svg>
					</div>
			</div>

			<div class="cursor"></div>

			<div class="prev-picture-arrow-middle arrow-middle" role="button" aria-label="Previous slide">
				<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="40" height="40">
					<path d="M23.5 11.5 L15.5 19.5 L23.5 27.5" stroke-linejoin="round" stroke-linecap="round" style="fill:none; stroke:#ffffff; stroke-width:3px"></path>
				</svg>
			</div>

			<div class="next-picture-arrow-middle arrow-middle" role="button" aria-label="Next slide">
				<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="40" height="40">
					<path d="M16.5 11.5 L24.5 19.5 L16.5 27.5" stroke-linejoin="round" stroke-linecap="round" style="fill:none; stroke:#ffffff; stroke-width:3px"></path>
				</svg>
			</div>
		</div>

		<div class="thumbnails no-rmswipe">
			<div class="scroll-wrapper">
				<div class="items-wrapper has-horizontal-scroll">
					<div class="items">
					</div>
				</div>
				<div class="scroll"></div>
			</div>
		</div>

		<div class="captions">
			<% if (tp == 'constructor') { %>
				<% if (newSlideshowCaptions) { %>
					<div class="caption caption-text-w"></div>
				<% } else { %>
					<textarea class="caption" maxlength="9999" placeholder="Type image caption here"></textarea>
				<% } %>
			<% } %>
		</div>

		<style id="slideshow-custom-styles-<%- id %>" type="text/css"></style>
	</div>

`}});var L,h,D,d,wt,J,Q=U(()=>{"use strict";L=b(at()),h=b(E()),D=b(it()),d=b(B());nt();rt();st();K();et();gt();dt();ut();ht();lt();ct();pt();_t();mt();z();wt=D.default.View.extend({THUMBNAILS_HEIGHT:72,COUNTERS_HEIGHT:40,COUNTERS_ADDITIONAL_SPACE:30,COUNTER_WIDTH:8+3+3,THUMBNAIL_WIDTH:56,THUMBNAIL_PADDING:4+4,THUMBNAILS_PADDING:8+8,swipeStartDistance:5,scrollStartDistance:3,swipeDistance:35,IMG_ACCELERATION_DELAY:500,AUTOPLAY_DELAY:4,SLIDER_TRANSITION:.5,events:{"click .images .prev-picture-arrow-middle":"prevImage","click .images .next-picture-arrow-middle":"nextImage","click .images .prev-picture-arrow-bottom":"prevImage","click .images .next-picture-arrow-bottom":"nextImage","click .images .fullscreen":"toggleFullscreen","click .counters-dots .counter":"counterClick","click .thumbnails .thumb":"thumbnailClick","click .images":"onImageClick","blur .captions .caption":"onCaptionBlur","mousemove .images.mouseover":"onMouseMove","mouseover .images.mouseover.viewer":"onMouseMove","mouseout  .images.mouseover.viewer":"onMouseOut","mouseenter  .images.play-on-hover.viewer":"onMouseEnter","mousemove  .images.play-on-hover.viewer":"changeSlideonHover","mouseleave  .images.play-on-hover.viewer":"stopAutoplay"},initialize:function({params:t,$container:e,environment:i,block:s,mag:o,page:a,viewport:n,textParams:l}={}){d.default.bindAll(this),this.template=j["template-common-slideshow-player"],this.block=s,this.model=s&&s.model,this.params=t,this.$container=e,this.environment=i,this.preloadImagesList=[],this.indexArr=[],this.mag=o,this.page=a,this.viewport=n,this.textParams=l,this.environment==="constructor"&&this.checkNeedUpdateWidget(),this.params.w=Math.ceil(this.params.w),this.handleCounters=i==="constructor"||t.theme_data.counters&&t.theme_data.counters_type==="dots"||t.current_theme==="theme_captions",this.handleThumbnails=i==="constructor"||t.theme_data.thumbnails,this.currentPic={$el:null,num:null},this.initialRender=!0,this.lastClick=0,this.slidesDirection="",this.render(),this.applyVisualState(t),this.applyPictures(t),(this.environment==="viewer"?this.params.version===2:!0)||this.applyTextStyles(t);let r=this.params.pictures||[];if(this.handleCounters&&this.$counters_container.css("width",r.length*this.COUNTER_WIDTH),this.$counters_container.children(":first-child").addClass("active"),this.handleThumbnails&&this.$thumbnails_container.css("width",r.length*(this.THUMBNAIL_WIDTH+this.THUMBNAIL_PADDING)-this.THUMBNAIL_PADDING),this.$thumbnails_container.children(":first-child").addClass("active"),this.recalcCounters(t),this.recalcThumbnails(t),this.moveToImage(this.currentImageID,!1,"change-pictures"),this.environment==="viewer"){let p=this.preloadImagesList.length;if(!p)return d.default.defer(d.default.bind(function(){this.trigger("ready")},this));let f=d.default.sortBy(r,"num")[0],w=y.getLqipUrl(f);if(w&&this.mag?.viewOpts?.lqip){let m=(0,h.default)("<div>").addClass("lqip-wrapper").css({height:`${this.params.images_h}px`,"border-radius":t.theme_data.radius?`${t.theme_data.radius}px`:""});(0,h.default)("<div>").addClass("lqip").css({transform:`scale(${t.theme_data.fill?1.1:.97})`,"border-radius":t.theme_data.radius?`${t.theme_data.radius}px`:"","background-image":`url(${w})`,"background-size":this.setImageSize(t.theme_data.fill,f.width,f.height,t.w,t.images_h)}).appendTo(m),m.prependTo(this.$images),this.$images.addClass("lqip")}let u=d.default.bind(function(){p--,!p&&!this.isDestroyed&&(this.$images.hasClass("lqip")&&(this.$images.find(".lqip-wrapper").remove(),this.$images.removeClass("lqip")),this.loadRemainingImages(),this.trigger("ready"))},this);d.default.each(this.preloadImagesList,function(m){this.isDestroyed||(m.preload=new Image,(0,h.default)(m.preload).on("load",u).on("error",u),m.preload.src=m.url)},this)}this.$container.append(this.$el),this.initialRender=!1,this.handleCounters&&$.isDesktop()&&(this.counters_scroll=this.$counters_scroll_wrapper.RMScroll({$container:this.$counters.find(".items-wrapper"),$content:this.$counters_container,$handle:this.$counters.find(".scroll"),wheelScrollSpeed:.1,scrollStep:14,tp:"horizontal",needRecalc:!1}).data("scroll")),this.handleThumbnails&&($.isDesktop()?this.thumbnails_scroll=this.$thumbnails_scroll_wrapper.RMScroll({$container:this.$thumbnails.find(".items-wrapper"),$content:this.$thumbnails_container,$handle:this.$thumbnails.find(".scroll"),wheelScrollSpeed:.3,onScroll:this.preloadThumbImages,tp:"horizontal",needRecalc:!1}).data("scroll"):this.$thumbnails.find(".items-wrapper").bind("scroll",this.preloadThumbImages)),this.setSwipeAction()},render:async function(){let t=this.environment==="viewer"?this.params.version===2:!0;if(this.setElement((0,h.default)(this.template({id:this.params._id,tp:this.environment,newSlideshowCaptions:t}))),this.$customStyles=this.$el.find(`#slideshow-custom-styles-${this.params._id}`),this.$el.attr("data-id",this.params._id),this.$images=this.$(".images"),this.$images_wrapper=this.$images.find(".images-wrapper"),this.$middle_arrows=this.$images.find(".arrow-middle"),this.$bottom_arrows=this.$images.find(".arrow-bottom"),this.$bottom_arrows_container=this.$images.find(".bottom-arrows"),this.$counters=this.$(".counters-dots"),this.$counters_container=this.$counters.find(".items"),this.$counters_scroll_wrapper=this.$counters.find(".scroll-wrapper"),this.$thumbnails=this.$(".thumbnails"),this.$thumbnails_container=this.$thumbnails.find(".items"),this.$thumbnails_scroll_wrapper=this.$thumbnails.find(".scroll-wrapper"),this.$captions=this.$(".captions"),this.environment==="constructor"){this.textWidgetWrapper=this.$captions.find(".caption");let{default:e}=await import("https://st-p.rmcdn.net/8e59565c/dist/c/c-IAU6N3HS.js");R({component:()=>x(H,{context:G,model:this.textParams.propsModel,children:x(e,{})}),domElement:this.textWidgetWrapper[0],model:this.textParams.model,onDestroy:()=>{let s=this.textWidgetWrapper[0];L.default.unmountComponentAtNode(s),s&&s.parentNode&&s.parentNode.removeChild(s)}})}},checkNeedUpdateWidget:function(){let t=Y(this.model.cloneJSON());t&&!d.default.isEmpty(t)&&this.model.set(t,{silent:!0})},loadRemainingImages:function(t){let e,i;if(t=t||this.$images_wrapper.children().filter(function(){return(0,h.default)(this).attr("data-src")}).toArray(),e=t.length<2?t.length:2,t&&t.length)for(i=0;i<=e;i++)this.preloadPictures(t,i,e)},preloadPictures:function(t,e,i){let s=new Image,o=this;if(t&&t[e]&&t[e].hasAttribute("data-src")){let a=(0,h.default)(t[e]).attr("data-src");s.onload=function(){(0,h.default)(t[e]).css({"background-image":'url("'+a+'")'}).removeAttr("data-src"),o.indexArr.push(e),o.indexArr.length-1===i&&(t.splice(0,i+1),o.indexArr=[],o.loadRemainingImages(t))},s.src=(0,h.default)(t[e]).attr("data-src")}},applyCustomStyles(t){if(this.$customStyles){let e="";t.cursorStyle&&(e+=`
          .common-slideshow[data-id="${t._id}"] .thumbnails .scroll-wrapper .items-wrapper .items .thumb.active {
            cursor: ${t.cursorStyle};
          }
          .common-slideshow[data-id="${t._id}"] .images .bottom-arrows .counters-container {
            cursor: ${t.cursorStyle};
          }
        `),e&&this.$customStyles.text(e)}},applyVisualState:function(t,e){if(!t.theme_data)return;let i={w:e?e.w:t.w,h:e?e.h:t.h,images_h:e?e.images_h:t.images_h,captions_h:e?e.captions_h:t.captions_h,thumbnails_h:this.THUMBNAILS_HEIGHT,counters_h:this.COUNTERS_HEIGHT,left_icon_noun:t.theme_data.left_icon_noun,right_icon_noun:t.theme_data.right_icon_noun,theme:t.current_theme,play_method:t.play_method,current_mode:t.current_mode,thumbnails:t.theme_data.thumbnails,arrows_type:t.theme_data.arrows_type,arrows_position:t.theme_data.arrows_position,arrows_view_mode:t.theme_data.arrows_view_mode,active_arrows:t.active_arrows,captions:t.theme_data.captions,counters:t.theme_data.counters,counters_type:t.theme_data.counters_type,counters_position:t.theme_data.counters_position,controls_bg:t.theme_data.controls_bg,show_on_hover:t.theme_data.show_on_hover,pictures:t.pictures,radius:t.theme_data.radius,transition_type:t.transition_type};i.showThumbnails=i.thumbnails,i.showCounters=i.counters,i.showCaptions=i.captions,i.showFullscreen=t.theme_data.fullscreen,i.showArrows=t.theme_data.arrows,i.showArrows!==void 0?(i.showBtmArrows=i.showArrows&&(i.arrows_position?i.arrows_position==="bottom":i.active_arrows?i.active_arrows==="bottom":i.theme==="theme_classic")&&i.arrows_view_mode==="normal",i.showMdlArrows=i.showArrows&&(i.arrows_position?i.arrows_position==="sides":i.active_arrows?i.active_arrows==="middle":i.theme==="theme_captions")&&i.arrows_view_mode==="normal"):(i.showBtmArrows=i.theme==="theme_classic",i.showMdlArrows=i.theme==="theme_captions");let s=["rm_left_3","rm_left_4","rm_left_5","rm_left_6","rm_left_7","rm_left_8","rm_left_9","rm_left_10","rm_left_11","rm_left_12","rm_left_13","rm_left_14","rm_right_3","rm_right_4","rm_right_5","rm_right_6","rm_right_7","rm_right_8","rm_right_9","rm_right_10","rm_right_11","rm_right_12","rm_right_13","rm_right_14"],o=["rm_left_15","rm_left_16","rm_left_17","rm_left_20","rm_right_15","rm_right_16","rm_right_17","rm_right_20"],a=i.left_icon_noun&&i.left_icon_noun.rm_id,n=i.right_icon_noun&&i.right_icon_noun.rm_id,l=this.$el.find(".prev-picture-arrow-middle"),c=this.$el.find(".next-picture-arrow-middle");l.toggleClass("first-pack",s.includes(a)).toggleClass("second-pack",o.includes(a)),a?l.attr("data-id",a):l[0].hasAttribute("data-id")&&l.removeAttr("data-id"),c.toggleClass("first-pack",s.includes(n)).toggleClass("second-pack",o.includes(n)),n?c.attr("data-id",n):c[0].hasAttribute("data-id")&&c.removeAttr("data-id"),this.$images.css("height",i.images_h),this.$thumbnails.css({display:i.showThumbnails?"block":"none",height:i.thumbnails_h}),this.$counters.css({display:i.showCounters&&(i.counters_type?i.counters_type==="dots":i.theme==="theme_captions")?"block":"none",height:i.counters_h}),this.$captions.css({display:i.showCaptions||i.theme==="theme_captions"?"block":"none",height:i.captions_h}),this.$images.find(".fullscreen").toggle(i.showFullscreen),i.theme&&i.theme==="theme_captions"&&!i.active_arrows&&(!i.counters_type||i.counters_type==="dots")&&this.setDotsPosition("middle"),i.arrows_type!==void 0&&this.$images.toggleClass("noun",i.showArrows&&(i.arrows_type==="library"||i.arrows_type==="noun")),i.arrows_view_mode!==void 0&&this.$images.toggleClass("mouseover",i.showArrows&&i.arrows_view_mode==="mouseover"),i.show_on_hover!==void 0&&(this.$images.toggleClass("show-on-hover",i.show_on_hover),this.$counters.toggleClass("show-on-hover",i.show_on_hover)),i.controls_bg!==void 0&&this.$images.toggleClass("controls-without-bg",!i.controls_bg),i.play_method!==void 0&&this.$images.toggleClass("play-on-hover",i.play_method==="hover"),this.$images.toggleClass("viewer",this.environment==="viewer"),i.arrows_view_mode!=="mouseover"&&this.$images.css("cursor",this.params.cursor||""),this.$bottom_arrows.toggle(i.showBtmArrows),this.$middle_arrows.toggle(i.showMdlArrows),this.$bottom_arrows_container.toggleClass("only-counters",i.arrows_position==="sides"||i.active_arrows==="middle"||i.showArrows===!1||i.arrows_view_mode==="mouseover"),this.$images.find(".counters-numbers").toggle(i.showCounters&&(i.counters_type?i.counters_type==="numbers":i.theme==="theme_classic")),i.counters_type==="dots"&&this.setDotsPosition(i.counters_position?i.counters_position:i.active_arrows);let r=t.theme_data,p=this.getRGBA(r.controls_color,r.controls_opacity),_=this.getRGBA(r.background_color,r.background_opacity);if(this.colorArrows(r.controls_color,r.controls_opacity),this.$("svg #full-screen").css("fill",p),this.$(".counters-numbers").css("color",p),i.counters_type==="dots"&&i.counters_position==="inside"&&d.default.defer(function(){this.$counters.find(".counter").css({background:p,"border-color":p})}.bind(this)),this.$images.css("background",_),this.$thumbnails.css("background",_),this.setPicsTransitions(),this.setNewPicsWidths(i.w),this.$images_wrapper.toggleClass("crossfade",i.transition_type==="crossfade"),this.$images_wrapper.css({"border-radius":i.radius}),this.$images_wrapper.children(".image").each(d.default.bind(function(f,w){let u=(0,h.default)(w);u.css({"background-size":this.setImageSize(r.fill,u.attr("data-width"),u.attr("data-height"),i.w,i.images_h),"border-radius":i.radius})},this)),!this.initialRender){let f=t.pictures||[];this.handleCounters&&this.$counters_container.css("width",f.length*this.COUNTER_WIDTH),this.handleThumbnails&&this.$thumbnails_container.css("width",f.length*(this.THUMBNAIL_WIDTH+this.THUMBNAIL_PADDING)-this.THUMBNAIL_PADDING),this.recalcCounters(t,e),this.recalcThumbnails(t,e),this.moveToImage(this.currentImageID,!1,"change-visual-style")}this.applyCustomStyles(t)},onMouseMove:function(t){let e=this.$images,i=this.getIconUrl().leftArrUrl,s=this.getIconUrl().rightArrUrl,o=this.isLeftSideOfWidget(t)?i:s,a=this.$el.find(".cursor"),n=this.getScale();if(this.environment==="constructor")Modernizr.safari&&(t.currentTarget.style.cursor=""),(0,h.default)(t.currentTarget).css({cursor:`url('${o}') 18 18, pointer`});else if((0,h.default)(t.target).hasClass("image")||(0,h.default)(t.target).hasClass("images-wrapper")||(0,h.default)(t.target).hasClass("bottom-arrows")){let l=v.isCSSZoom()?n:1,c=v.isCSSTransform()?n:1,r=k.mapElementToDocument(e[0],c,l),p=k.mapPointerToDocument(t,c,l),_=k.absoluteToRelative(p,r);a.show().css({..._,cursor:"none","background-image":`url('${o}')`}),(0,h.default)(t.currentTarget).css({cursor:"none"})}else a.css({"background-image":"none"})},onMouseOut:function(){this.$el.find(".cursor").hide()},getIconUrl:function(){let t=this.getModelData("theme_data").arrows_type,e,i,s;return this.environment==="constructor"||this.environment==="viewer"&&t==="default"?(e=this.sanitizeSVG(this.$bottom_arrows.find("svg").first()),i=this.sanitizeSVG(this.$bottom_arrows.find("svg").last())):(s=this.params.theme_data.arrows_position,e=(s==="bottom"?this.$el.find(".prev-picture-arrow-bottom img"):this.$el.find(".prev-picture-arrow-middle img")).attr("src"),i=(s==="bottom"?this.$el.find(".next-picture-arrow-bottom img"):this.$el.find(".next-picture-arrow-middle img")).attr("src")),{leftArrUrl:e,rightArrUrl:i}},sanitizeSVG:function(t){let e=(this.environment==="constructor"?this.model.get("theme_data"):this.params.theme_data).arrows_type,i="data:image/svg+xml;charset=utf-8,";return(e==="library"||e==="noun")&&t.attr({height:"36",width:"36"}),i+=t[0].outerHTML.replace(/#/g,"%23").replace(/(\r\n|\n|\r)/gm,""),i},colorArrows:function(t,e){let i=this.getRGBA(t,e);this.$("svg path").css("stroke",i),this.$("svg").css("fill",i)},setDotsPosition:function(t){let e,i;(t==="middle"||t==="outside")&&(this.$counters.remove(),this.$thumbnails.after(this.$counters),this.$counters.addClass("down-position"),this.$counters.find(".counter").css("background","#fff")),this.$thumbnails.next(".counters-dots").length&&this.$thumbnails.next(".counters-dots").length>0&&(t==="bottom"||t==="inside")&&(this.$counters.remove(),this.$images.find(".counters-numbers").after(this.$counters),this.$counters.removeClass("down-position"),this.environment==="constructor"&&(e=this.model.get("theme_data"),i=this.getRGBA(e.controls_color,e.controls_opacity),this.$counters.find(".counter").css("background",i)))},getRGBA:function(t,e){let i="",s=[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)];return e>.99?i="rgb("+s[0]+","+s[1]+","+s[2]+")":i="rgba("+s[0]+","+s[1]+","+s[2]+", "+e+")",i},getThumbUrl:function(t){if(!y.useLambdaUrl(t))return t.thumbUrl;let e={width:N.THUMB_SIZE_SLIDESHOW,height:N.THUMB_SIZE_SLIDESHOW,originalW:t.width,originalH:t.height};return this.environment!=="constructor"&&(e.scale=this.mag.getScale(this.viewport)),y.getThumbnailUrl(t,e)},getOriginalUrl:function(t){return t.rasterUrl||t.url},getModelData:function(t){return this.environment==="constructor"?this.model.get(t):this.params[t]},getScaledUrl:function(t){let e=this.getModelData("theme_data");if(y.useLambdaUrl(t)||y.useLambdaUrlOldProjects(t,"slideshow")){let i=this.getModelData("images_h"),o=W.normalizeAnimations(this.getModelData("animation")).reduce((n,l)=>Math.max(n,W.maxScaleAnimation(l)),0),a={originalW:t.width,originalH:t.height};return e.fullscreen||(a.height=i,a.scale=this.environment==="constructor"?RM.constructorRouter.zoom.getZoom():this.mag.getScale(this.viewport),a.animationScale=o&&o/100),y.getLambdaUrl(t,a)}return v.isOn(this.viewport,this.mag.getViewportWidth(this.viewport),this.environment==="constructor"?this.mag.get("opts"):this.mag.viewOpts)||e.fullscreen?t.unscaledOptimizedUrl||t.rasterUrl||t.url:Modernizr.retina?t.scaled2xUrl||t.unscaledOptimizedUrl||t.rasterUrl||t.url:t.scaledUrl||t.unscaledOptimizedUrl||t.rasterUrl||t.url},applyPictures:function(t){if(!t.theme_data)return;let e=t.pictures||[];this.$el.toggleClass("no-images",!e.length),this.$bottom_arrows_container.toggleClass("no-images",e.length<=1),this.$middle_arrows.toggleClass("no-images",e.length<=1),this.$images.find(".bottom-arrows .counters-text-total").text(e.length),this.$images_wrapper.empty(),this.handleCounters&&this.$counters_container.empty(),this.handleThumbnails&&this.$thumbnails_container.empty(),e=d.default.sortBy(e,"num");let i,s,o;e.length>1&&e.length<4&&(s=[...e],o=s.map(l=>{let c={...l};return c.fakedId=M.generateUUID(),c.faked=!0,c}),i=h.default.merge(e,o));for(let l=0;l<(i?i.length:e.length);l++){var a,n=e[l];a=(0,h.default)("<div>").addClass("image").attr("data-id",n.fakedId?n.fakedId:n.id).toggleClass("error",!!n.error).css({"background-size":this.setImageSize(t.theme_data.fill,n.width,n.height,t.w,t.images_h)}).appendTo(this.$images_wrapper),a.attr("role","img");let c=this.getModelData("commonAlt");if(typeof c=="string"?a.attr("aria-label",d.default.escape(c)):typeof n.alt=="string"&&a.attr("aria-label",d.default.escape(n.alt)),n.fakedId&&a.attr("data-original-id",n.id),this.environment==="constructor"&&a.css({"background-image":n.url?'url("'+this.getScaledUrl(n)+'")':"none"}),this.environment==="viewer"&&n.url&&(a.attr("data-src",this.getScaledUrl(n)),n.scaledUrl&&a.data("orig-src",this.getOriginalUrl(n))),n.url&&n.width&&n.height&&a.attr("data-width",n.width).attr("data-height",n.height),this.handleThumbnails&&!n.faked){a=(0,h.default)("<div>").addClass("thumb").attr("data-id",n.id).toggleClass("error",!!n.error).css({left:(this.THUMBNAIL_WIDTH+this.THUMBNAIL_PADDING)*l-this.THUMBNAIL_PADDING/2}).appendTo(this.$thumbnails_container);let r=this.getThumbUrl(n);this.environment==="constructor"&&a.css({"background-image":r?`url("${r}")`:"none"}),this.environment==="viewer"&&r&&a.attr("data-src",r)}if(this.handleCounters&&!n.faked&&(0,h.default)("<div>").addClass("counter").attr("data-id",n.id).css({left:this.COUNTER_WIDTH*l}).appendTo(this.$counters_container),(this.params.theme_data.captions||this.params.current_theme==="theme_captions")&&this.environment==="viewer"&&!n.faked){let r=(0,h.default)("<div>").addClass("caption-wrapper").attr("data-id",n.id);if(n.caption){let p=(0,h.default)("<div>").addClass("caption caption-text-w").appendTo(r),_=new D.default.Model({page:this.page,currentPage:this.mag.currentPage||this.page,scale:this.page.scale,viewport:this.viewport,viewerOptions:this.mag.viewOpts,mag:this.mag}),f=new D.default.Model(n.caption),w=O(f);R({component:()=>x(H,{context:V,model:_,children:x(Z,{editorState:w})}),domElement:p[0],model:f,onDestroy:()=>{let m=p[0];L.default.unmountComponentAtNode(m),m&&m.parentNode&&m.parentNode.removeChild(m)}})}else(0,h.default)("<div>").addClass("caption").html(M.plainTextToHtml(n.text,{detectLinks:!0})).appendTo(r);r.appendTo(this.$captions)}}this.$images_wrapper.children(":first-child").data("first-child",!0),this.$images_wrapper.children(":last-child").data("last-child",!0),this.updateCurrentImageID(t),this.initialRender||(this.handleCounters&&this.$counters_container.css("width",e.length*this.COUNTER_WIDTH),this.handleThumbnails&&this.$thumbnails_container.css("width",e.length*(this.THUMBNAIL_WIDTH+this.THUMBNAIL_PADDING)-this.THUMBNAIL_PADDING),this.recalcCounters(t),this.recalcThumbnails(t),this.moveToImage(this.currentImageID,!1,"change-pictures")),e.length||this.$images.find(".bottom-arrows .counters-text .counters-text-current").html(0),this.$images_wrapper.children(".image").each(d.default.bind(function(l,c){let r=(0,h.default)(c),p=this.environment==="viewer"?this.params.theme_data.radius:this.model.get("theme_data").radius;r.css({"border-radius":p})},this))},applyTextStyles:function(t){let e=d.default.omit(t.text_style,"size-leading-linked","size-leading-ratio");/px/i.test(e["font-size"])||(e["font-size"]+="px"),/px/i.test(e["letter-spacing"])||(e["letter-spacing"]+="px"),/px/i.test(e["line-height"])||(e["line-height"]+="px"),/#/i.test(e.color)||(e.color="#"+e.color),e.opacity/=100,this.$captions.find(".caption").css(e)},setNewPicsWidths:function(t){let e=this.mag.getViewportWidth(this.viewport),i=this.$el.find("#slideshow-images-position-style-"+this.params._id),s=$.isDesktop()?"":"translateZ(0)",o=v.isOn(this.viewport,e,this.environment==="constructor"?this.mag.get("opts"):this.mag.viewOpts)?v.getRatio(e):1,a;this.isSlider()?a='          .common-slideshow[data-id="'+this.params._id+`"] .images .images-wrapper {
            left: 0px;
            width: `+t+`px;
          }
          .common-slideshow[data-id="`+this.params._id+`"] .images .images-wrapper .image {
            left: 0px;
            width: `+t+`px;
          }
          .common-slideshow[data-id="`+this.params._id+`"] .images .images-wrapper .image.prev-image {
            -webkit-transform: translateX(`+-t+"px)"+s+`;
            transform: translateX(`+-t+"px)"+s+`;
          }
          .common-slideshow[data-id="`+this.params._id+`"] .images .images-wrapper .image.center-image {
            -webkit-transform: translateX(0) `+s+`;
            transform: translateX(0) `+s+`;
          }
          .common-slideshow[data-id="`+this.params._id+`"] .images .images-wrapper .image.next-image {
            -webkit-transform: translateX(`+t+"px)"+s+`;
            transform: translateX(`+t+"px)"+s+`;
          }
                    .edge .common-slideshow[data-id="`+this.params._id+`"] .images .images-wrapper {
            left: 0px;
            width: `+t+`px;
          }
          .edge .common-slideshow[data-id="`+this.params._id+`"] .images .images-wrapper .image {
            left: 0px;
            width: `+t+`px;
          }
          .edge .common-slideshow[data-id="`+this.params._id+`"] .images .images-wrapper .image.prev-image {
            -webkit-transform: translateX(`+Math.ceil(-t*o)+"px) "+s+`;
            transform: translateX(`+Math.ceil(-t*o)+"px) "+s+`;
          }
          .edge .common-slideshow[data-id="`+this.params._id+`"] .images .images-wrapper .image.center-image {
            -webkit-transform: translateX(0) `+s+`;
            transform: translateX(0) `+s+`;
          }
          .edge .common-slideshow[data-id="`+this.params._id+`"] .images .images-wrapper .image.next-image {
            -webkit-transform: translateX(`+Math.ceil(t*o)+"px) "+s+`;
            transform: translateX(`+Math.ceil(t*o)+"px) "+s+`;
        }
      `:a='      .common-slideshow[data-id="'+this.params._id+`"] .images .images-wrapper {
        left: 0px;
        width: `+t+`px;
      }
      .common-slideshow[data-id="`+this.params._id+`"] .images .images-wrapper .image {
        left: 0px;
        opacity: 0;        width: `+t+`px;
      }
      .common-slideshow[data-id="`+this.params._id+`"] .images .images-wrapper .image.center-image {
        opacity: 1;        }
      .edge .common-slideshow[data-id="`+this.params._id+`"] .images .images-wrapper {
        left: 0px;
        width: `+t+`px;
      }
      .edge .common-slideshow[data-id="`+this.params._id+`"] .images .images-wrapper .image {
        left: 0px;
        width: `+t+`px;
      }
      `,i.length||(i=(0,h.default)('<style id="slideshow-images-position-style-'+this.params._id+'" type="text/css">'),i.appendTo(this.$el)),i.text(a)},getPlayMethod:function(){return this.environment==="viewer"?this.params.play_method:this.model.get("play_method")},getCrossfadeTransitionTime:function(){return(this.environment==="viewer"?this.params.theme_data:this.model.get("theme_data")).crossfade},isSlider:function(){let t;return this.environment==="viewer"&&this.params.transition_type?t=this.params.transition_type==="slider":this.environment==="constructor"&&this.model.get("transition_type")?t=this.model.get("transition_type")==="slider":t=!0,t},getTransitionsTime:function(){return this.isSlider()?this.getSliderTransitionTime():this.getCrossfadeTransitionTime()},getTransitionsDelay:function(){let t,e,i;return this.environment==="viewer"?(t=this.params.play_method,e=this.params.theme_data):(t=this.model.get("play_method"),e=this.model.get("theme_data")),i=t==="hover"?e.hover_delay:t==="autoplay"||e.autoplay?e.autoplay_delay:0,i*1e3||this.AUTOPLAY_DELAY},setPicsTransitions:function(t,e){let i=this.$el.find("#slideshow-images-transition-style-"+this.params._id),s="cubic-bezier(0.40, 0.24, 0.40, 1)",o=!this.isSlider()&&this.getPlayMethod()==="scroll"?"ease-out":"ease-in-out",a=e==="prev"?"next":"prev",n=this.isSlider()&&this.getPlayMethod()==="scroll",l=n?0:this.getTransitionsTime(),c;t=t||l,this.isSlider()?c='          .common-slideshow[data-id="'+this.params._id+`"] .images .images-wrapper.enable-transitions .image {
            -webkit-transition: transform `+t+"s "+s+";            transition: transform "+t+"s "+s+`;          }
          .common-slideshow[data-id="`+this.params._id+`"] .images .images-wrapper.enable-transitions .image.center-image {
            -webkit-transition: transform `+(t-.05)+"s "+s+";            transition: transform "+(t-.05)+"s "+s+`;        }
        .common-slideshow[data-id="`+this.params._id+'"] .images .images-wrapper.enable-transitions .image.'+e+`-image {
            -webkit-transition: transform 0s `+s+";        transition: transform 0s "+s+`;        }
        .common-slideshow[data-id="`+this.params._id+'"] .images .images-wrapper.enable-transitions .image.'+a+`-image {
            -webkit-transition: transform `+t+"s "+s+";        transition: transform "+t+"s "+s+`;        }
        `:c='        .common-slideshow[data-id="'+this.params._id+`"] .images .images-wrapper.enable-transitions .image {
        -webkit-transition: opacity `+t+"s "+o+";        transition: opacity "+t+"s "+o+`;        }
        .common-slideshow[data-id="`+this.params._id+`"] .images .images-wrapper.enable-transitions .image.center-image {
        -webkit-transition: opacity `+t+"s "+o+";        transition: opacity "+t+"s "+o+`;        }
        `,i.length||(i=(0,h.default)('<style id="slideshow-images-transition-style-'+this.params._id+'" type="text/css">'),i.appendTo(this.$el)),i.text(c)},getSliderTransitionTime:function(){return RM.screenshot?void 0:(this.environment==="viewer"?this.params.theme_data.slider_transition:this.model.get("theme_data").slider_transition)||this.SLIDER_TRANSITION},setImageSize:function(t,e,i,s,o){if(!e||!i)return t?"cover":"contain";let a,n;return t?(s/o>e/i?(a=s+2,n=Math.round(a*i/e)):(n=o+2,a=Math.round(n*e/i)),a+"px "+n+"px"):e<s&&i<o?e+"px "+i+"px":(s/o>e/i?(n=o+2,a=Math.round(n*e/i)):(a=s+2,n=Math.round(a*i/e)),a+"px "+n+"px")},onCaptionBlur:function(){if(this.environment==="viewer"||!this.model)return;let t=this.$captions.find(".caption").val(),e=d.default.clone(this.model.get("pictures")),i=d.default.findWhere(e,{id:this.$captions.find(".caption").attr("data-id")});if(!i||i.text===t)return;let s=e.indexOf(i);e[s]=d.default.extend({},i,{text:t}),this.model.save({pictures:e},{toHistory:!0}),this.block.workspace.trigger("redraw")},recalcCounters:function(t,e){if(!(t.theme_data.counters_type==="dots"||t.current_theme==="theme_captions"))return;let i=t.pictures||[],s=e?e.w:t.w,o=this.COUNTER_WIDTH*i.length,a=Math.floor(s/this.COUNTER_WIDTH)*this.COUNTER_WIDTH,n=this.$bottom_arrows_container.hasClass("only-counters")&&i.length>2?this.COUNTERS_ADDITIONAL_SPACE:0,l=Math.min(o,a)+n,c=t.theme_data.counters_position?t.theme_data.counters_position==="outside":t.active_arrows?t.active_arrows==="middle":t.current_theme==="theme_captions",r=c?Math.floor((s-l)/2):0;this.$counters_scroll_wrapper.css({left:r,width:l}),this.$counters_container.css({width:o})},recalcThumbnails:function(t,e){if(!t.theme_data.thumbnails)return;let i=t.pictures||[],s=e?e.w:t.w,o=i.length*(this.THUMBNAIL_WIDTH+this.THUMBNAIL_PADDING)-this.THUMBNAIL_PADDING,a=Math.min(o,s-this.THUMBNAILS_PADDING),n=Math.floor((s-a)/2);this.thumbsWidth=a,this.$thumbnails_scroll_wrapper.css({left:n,width:a}),this.$thumbnails_container.css({width:o})},onImageClick:function(t){let e;this.isNormalArrowsMode()||this.block&&!this.block.selected||(t&&t.stopPropagation(),this.getPlayMethod()==="hover"&&(e="switch-to-image-autoplay"),this.isLeftSideOfWidget(t)?this.prevImage(t,e):this.nextImage(t,e))},isLeftSideOfWidget:function(t){let e=this.$images,i=this.getScale(),s=v.getBox(e.get(0)),o=this.environment!=="constructor"&&v.isCSSTransform()?i:1,a=$.isDesktop()&&(this.environment==="constructor"||v.isCSSZoom())?i:1;return t.clientX/a/o<(s.left+(this.isFullscreenMode?(0,h.default)(window).width():s.width)/2)/o},isNormalArrowsMode:function(){return this.environment==="constructor"&&this.model.get("theme_data")&&this.model.get("theme_data").arrows_view_mode==="normal"},getScale:function(){return this.isFullscreenMode?1:this.environment==="constructor"?RM.constructorRouter.zoom.getZoom():this.mag.getScale(this.viewport)},prevImage:function(t,e){this.imagePrevNext(t,"prev",e||"switch-to-image")},checkNeedUpdateTransition:function(t,e){let i=this.getTransitionsTime(),s=this.$images_wrapper.children(":first").css("transition-duration")?parseFloat(this.$images_wrapper.children(":first").css("transition-duration")):i,o;t&&t.timeStamp?(o=(t.timeStamp-this.lastClick)/1e3,o<i?this.setPicsTransitions(o.toFixed(1),e):s<i&&this.setPicsTransitions(i,e),this.lastClick=t.timeStamp):this.setPicsTransitions(i,e),this.slidesDirection!==e&&(this.setPicsTransitions(i,e),this.slidesDirection=e)},nextImage:function(t,e){this.imagePrevNext(t,"next",e||"switch-to-image")},imagePrevNext:function(t,e,i){if(!this.currentImageID)return;let s=e==="next"?this.currentPic.$el.next():this.currentPic.$el.prev();s.length||(s=this.$images_wrapper.children(":"+(e==="next"?"first":"last"))),this.checkNeedUpdateTransition(t,e),this.$images_wrapper.children(".changed-opacity").each(d.default.bind(function(o,a){let n=(0,h.default)(a);n.css({opacity:""}),n.removeClass("changed-opacity")},this)),this.moveToImage(s.attr("data-id"),!0,i),t&&t.stopPropagation()},changeSlideonHover:function(t){let e=this.isLeftSideOfWidget(t)?"prev":"next";this.slidesDirection!==e&&this.stopAutoplay(),this.startAutoplay(e),this.slidesDirection=e},onMouseEnter:function(t){this.onImageClick(t),this.changeSlideonHover(t)},thumbnailClick:function(t){this.moveToImage((0,h.default)(t.currentTarget).attr("data-id"),!1,"switch-to-image"),t.stopPropagation()},counterClick:function(t){this.moveToImage((0,h.default)(t.currentTarget).attr("data-id"),!1,"switch-to-image"),t.stopPropagation()},moveToImage:function(t,e,i){if(!t)return;let s=this.$images_wrapper.children(".image"),o=s.filter('[data-id="'+t+'"]'),a=o.attr("data-original-id"),n=s.index(o),l=d.default.clone(this.currentPic),c={num:n},r=this,p=this.environment==="viewer"?this.params.pictures.length:this.model.get("pictures").length,_=this.getTransitionsDelay(),f=this.getTransitionsTime()*1e3;if(t=a||t,!o.length||n===-1)return;this.previousImageID=this.currentImageID,this.currentImageID=t,this.currentPic.$el=o,this.currentPic.num=n,i==="switch-to-image"&&this.environment==="viewer"&&(this.params.theme_data.autoplay&&this.params.play_method===void 0||this.params.play_method==="autoplay"||this.params.play_method==="hover")&&(this.stopAutoplay(),setTimeout(()=>this.startAutoplay(),_)),this.$images_wrapper.toggleClass("enable-transitions",e),this.resetWaitForAnimationEnd(),e&&l.$el&&this.waitForAnimationEnd(l.$el,w),this.direction=!l.$el||!l.$el.length||l.num<c.num?"forward":"backward",o.data("first-child")&&l.$el&&l.$el.length&&l.$el.data("last-child")?this.direction="forward":o.data("last-child")&&l.$el&&l.$el.length&&l.$el.data("first-child")&&(this.direction="backward"),s.each(function(u){let m=(0,h.default)(this),g=s.length-1;s.length!==1?u+1===c.num||c.num===0&&u===g?r.setPicPosition(m,"prev",!0):u-1===c.num||c.num===g&&u===0?r.setPicPosition(m,"next",!0):u===c.num?r.setPicPosition(m,"center",u===c.num):r.setPicPosition(m,"",!1):r.setPicPosition(m,"center",u===c.num)}),p>1&&p<4&&(n=n>=p?n-p:n),r.$images.find(".counters-text-current").html(n+1),!e&&w();function w(){if(!e&&!r.initialRender&&window.requestAnimationFrame(function(){r.$images_wrapper.addClass("enable-transitions")}),r.trigger("currentImageChanged",t,e,i),r.handleCounters&&!r.initialRender){let I=r.$counters_container.children('[data-id="'+t+'"]');r.$counters_container.children(".active").removeClass("active"),I.addClass("active");var u=I.get(0).offsetLeft,m=r.$counters.find(".items-wrapper").width(),g=void 0;u+r.COUNTER_WIDTH*2-r.$counters.find(".items-wrapper").scrollLeft()>m?g=u+r.COUNTER_WIDTH*2-m:u-r.COUNTER_WIDTH-r.$counters.find(".items-wrapper").scrollLeft()<0&&(g=u-r.COUNTER_WIDTH),g!==void 0&&(e?r.$counters.find(".items-wrapper").stop().animate({scrollLeft:g},f):r.$counters.find(".items-wrapper").scrollLeft(g))}if(r.handleThumbnails&&!r.initialRender){let I=r.$thumbnails_container.children('[data-id="'+t+'"]');r.$thumbnails_container.children(".active").removeClass("active"),I.addClass("active");var u=I.position().left,m=r.$thumbnails.find(".items-wrapper").width(),g=void 0;u+(r.THUMBNAIL_WIDTH+r.THUMBNAIL_PADDING)*2-r.THUMBNAIL_PADDING/2-r.$thumbnails.find(".items-wrapper").scrollLeft()>m?g=u+(r.THUMBNAIL_WIDTH+r.THUMBNAIL_PADDING)*2-r.THUMBNAIL_PADDING/2-m:m>(r.THUMBNAIL_WIDTH+r.THUMBNAIL_PADDING)*2&&u-r.THUMBNAIL_WIDTH-r.THUMBNAIL_PADDING/2-r.$thumbnails.find(".items-wrapper").scrollLeft()<0&&(g=u-r.THUMBNAIL_WIDTH-r.THUMBNAIL_PADDING/2)}if(g!==void 0&&(e?r.$thumbnails.find(".items-wrapper").stop().animate({scrollLeft:g},f):r.$thumbnails.find(".items-wrapper").scrollLeft(g)),r.model&&r.environment==="constructor"){let I=r.model.get("pictures"),C=d.default.findWhere(I,{id:r.currentImageID});if(C&&r.$captions.find(".caption").attr("data-id",r.currentImageID),C&&!C.caption&&r.previousImageID!==r.currentImageID){let P=I.find(tt=>tt.id===r.previousImageID);P&&P.caption&&(r.lastTextStyle=q({editorState:O(new D.default.Model(P.caption))}))}r.block.nonReactSetSharedState(r.block.createTextState({rawModel:C&&C.caption,lastStyle:r.lastTextStyle}))}else(r.params.theme_data.captions||r.params.current_theme==="theme_captions")&&r.environment==="viewer"&&(e?r.$captions.find('.caption-wrapper[data-id="'+r.currentImageID+'"]').stop().fadeIn(200).siblings().stop().fadeOut(200):(r.$captions.find(".caption-wrapper").stop().css({display:"none"}),r.$captions.find('.caption-wrapper[data-id="'+r.currentImageID+'"]').stop().css({display:"block"})));r.preloadImages(),r.preloadThumbImages()}},waitForAnimationEnd:function(t,e){this.resetWaitHook=M.waitForTransitionEnd(t,this.getTransitionsTime(),"transform",e)},resetWaitForAnimationEnd:function(){this.resetWaitHook&&this.resetWaitHook()},setPicPosition:function(t,e,i){(0,h.default)(t).removeClass("center-image prev-image next-image neighbour hidden").addClass((e?e+"-image ":"hidden")+(i?"neighbour":"")),(0,h.default)(t).data("last-position",e),(0,h.default)(t).data("last-neighbour",i)},preloadImages:function(){if(this.environment!=="viewer")return;let t=this.$images_wrapper.children('[data-id="'+this.currentImageID+'"]');if(!t.length)return;let e=t.prev();e.length||(e=this.$images_wrapper.children(":last"));let i=t.next();i.length||(i=this.$images_wrapper.children(":first"));let s=this;o(t),RM.screenshot||(o(e),o(i));function o(a){if(s.isFullscreenMode){if(a.data("orig-src")){let n=new Image;n.onload=function(){a.css({"background-image":'url("'+n.src+'")'}).removeData("orig-src")},n.src=a.data("orig-src")}s.$images_wrapper.find(".image").css("border-radius",0)}a.attr("data-src")&&(s.preloadImagesList.push({url:a.attr("data-src")}),a.css({"background-image":'url("'+a.attr("data-src")+'")'}).removeAttr("data-src"))}},preloadThumbImages:function(){if(this.environment!=="viewer"||!this.params.theme_data.thumbnails)return;let t=this.initialRender?this.thumbsWidth:this.$thumbnails_scroll_wrapper.width(),e=this.initialRender?0:this.$thumbnails.find(".items-wrapper").scrollLeft();this.$thumbnails.find(".items-wrapper .thumb").each(d.default.bind(function(i,s){let o=(0,h.default)(s);if(o.attr("data-src")){let n=i*this.THUMBNAIL_WIDTH-this.THUMBNAIL_PADDING/2,l=this.THUMBNAIL_WIDTH+this.THUMBNAIL_PADDING;n-e>t+l||n+l-e<0-l||(this.preloadImagesList.push({url:o.attr("data-src")}),o.css({"background-image":'url("'+o.attr("data-src")+'")'}).removeAttr("data-src"))}},this))},updateCurrentImageID:function(t){if(!t.pictures||!t.pictures.length){this.currentImageID=void 0;return}if(!this.currentImageID)this.currentImageID=this.getFirstPictureID(t);else{let e=d.default.findWhere(t.pictures,{id:this.currentImageID});this.currentImageID=e?e.id:this.getFirstPictureID(t)}},getFirstPictureID:function(t){return d.default.sortBy(t.pictures,"num")[0].id},toggleFullscreen:function(t){this.environment!=="constructor"&&(this.isFullscreenMode?this.leaveFullscreen():this.enterFullscreen(),t.stopPropagation())},enterFullscreen:function(){this.environment!=="constructor"&&(this.isFullscreenMode||(this.isFullscreenMode=!0,this.$parentBeforeFullscreen=this.$el.parent(),(0,h.default)(".constructor #widgetbar").addClass("hidden"),this.$el.addClass("fullscreen-mode"),this.$el.appendTo("body").css("z-index",999),(0,h.default)(window).on("resize",this.onFullscreenResize),(0,h.default)("body").on("keyup",this.onFullscreenKeyUp),d.default.defer(function(){RM.common.disableShortcuts.slideshow=!0}),this.onFullscreenResize(),X(),this.preloadImages()))},onFullscreenKeyUp:function(t){t.keyCode===h.default.keycodes.left&&this.prevImage(),t.keyCode===h.default.keycodes.right&&this.nextImage(),t.keyCode===h.default.keycodes.esc&&this.leaveFullscreen()},onFullscreenResize:function(){let t=this.$el.width(),e=this.$el.height(),i=this.params.theme_data.counters&&((this.params.active_arrows==="middle"||this.params.theme_data.counters_position==="outside")&&this.params.theme_data.counters_type==="dots"||this.params.current_theme==="theme_captions"),s=e-(this.params.theme_data.thumbnails?this.THUMBNAILS_HEIGHT:0)-(this.params.theme_data.captions||this.params.current_theme==="theme_captions"?this.params.captions_h:0)-(i?this.COUNTERS_HEIGHT:0);this.applyVisualState(this.params,{w:t,h:e,images_h:s,captions_h:this.params.captions_h})},leaveFullscreen:function(){this.environment!=="constructor"&&this.isFullscreenMode&&(this.isFullscreenMode=!1,this.$el.appendTo(this.$parentBeforeFullscreen).css("z-index","auto"),(0,h.default)(window).off("resize",this.onFullscreenResize),this.$el.removeClass("fullscreen-mode"),(0,h.default)(".constructor #widgetbar").removeClass("hidden"),(0,h.default)("body").off("keyup",this.onFullscreenKeyUp),d.default.defer(function(){delete RM.common.disableShortcuts.slideshow}),this.applyVisualState(this.params),this.setNewPicsWidths(this.params.w))},startAutoplay:function(t){let e;this.autoPlayInterval||(e=(t?this.params.theme_data.hover_delay:this.params.theme_data.autoplay_delay||this.AUTOPLAY_DELAY)*1e3,this.autoPlayInterval=setInterval(d.default.bind(function(){this.imagePrevNext(null,t||"next","switch-to-image-autoplay")},this),e))},stopAutoplay:function(){clearInterval(this.autoPlayInterval),this.autoPlayInterval=null},destroy:function(){this.isDestroyed=!0,this.stopAutoplay(),this.leaveFullscreen(),this.resetWaitForAnimationEnd(),this.$el&&this.$el.remove(),this.textWidgetWrapper&&L.default.unmountComponentAtNode(this.textWidgetWrapper[0])},setSwipeAction:function(){$.isDesktop()||(this.picsSwipe=this.$images_wrapper.RMSwipe({$scrollElements:this.mag.$mag_container,maxTransitionSpeed:this.getTransitionsTime()*1e3,rubberBandForce:1/1.47,getCurrentConstraints:function(){let t={},e=this.isFullscreenMode?this.$images_wrapper.width():this.params.w;return t.$moveItems=this.currentPic.$el.add(this.currentPic.$el.prev()).add(this.currentPic.$el.next()),t.$referenceItem=t.$moveItems.filter(":not(.center-image)").first(),this.currentPic.$el.is(":last-child")?t.left={max:0,noTrigger:!0}:t.left={max:e},this.currentPic.$el.is(":first-child")?t.right={max:0,noTrigger:!0}:t.right={max:e},t}.bind(this),onSwipeStart:function(){let t=this.getTransitionsDelay(),e,i;this.environment==="viewer"?(e=this.params.play_method,i=this.params.theme_data.autoplay&&e===void 0):(e=this.model.get("play_method"),i=this.model.get("theme_data").autoplay),(e==="autoplay"||i)&&(this.stopAutoplay(),setTimeout(()=>this.startAutoplay(),t)),this.$images_wrapper.removeClass("enable-transitions")}.bind(this),customMoveCheck:function(t,e){return!(t.hasClass("prev-image")&&e<0||t.hasClass("next-image")&&e>0)}.bind(this),callback:function(t){let e;t==="right"&&(e=this.currentPic.$el.prev()),t==="left"&&(e=this.currentPic.$el.next()),e.length||(e=this.currentPic.$el),this.moveToImage(e.attr("data-id"),!1,"switch-to-image")}.bind(this)}).data("swipe"))}}),J=wt});var T,S,vt,Et,It=U(()=>{T=b(E()),S=b(B());ft();Q();vt=A.extend({MIN_TOP_SCROLL_SPACE:5,TIME_OF_STOPPED_SCROLL:55,render:function(){return this.makeBox("widget-slideshow"),this.pictures=S.default.filter(this.pictures,function(t){return!t.error}),this.player=new J({params:this,$container:this.$el,environment:"viewer",block:null,mag:this.page&&this.page.mag,page:this.page,viewport:this.page.pageViewport}),this.play_method!==void 0&&this.play_method==="scroll"&&((0,T.default)(window).on("scroll",this.onScrollTransition),this.innerContentTop=this.page.contentPosition.top/this.page.scale,this.innerContainerHeight=this.page.mag.getContainerSizeCached().height/this.page.scale,this.isScrolling=!1,this.$image=this.$el.find(".image"),this.lastScrollTop=0,this.isCrossfade=this.transition_type==="crossfade",this.delay=(this.theme_data.scroll_delay>0?this.theme_data.scroll_delay:1)+(this.isCrossfade?this.theme_data.crossfade:0),this.picsID=[],this.player.$images_wrapper.children(".image").each((e,i)=>{this.picsID.push((0,T.default)(i).attr("data-id"))})),this.player.on("ready",S.default.bind(function(){setTimeout(this.widgetIsLoaded,100)},this)),this.theme_data.arrows&&(this.theme_data.arrows_type==="library"||this.theme_data.arrows_type==="noun")&&this.renderNounIcons(),this.rendered=!0,this},onScrollTransition:function(){let t=window.pageYOffset||document.documentElement.scrollTop,e=this.y+this.innerContentTop,i=e-this.innerContainerHeight,s=0,o=s*(e-i)+i+this.theme_data.start_offset||0,a=this.isCrossfade?this.theme_data.crossfade*10:this.TIME_OF_STOPPED_SCROLL,n=this.picsID.length,l=o>0?(t-o*this.page.scale)/this.page.scale:t/this.page.scale,c=Math.floor(l/this.delay),r=c+1,p=r>=n?r-Math.floor(r/n)*n:r;this.isScrolling&&(this.setFreezeStyles(t),p>=0&&this.player.currentImageID!==this.picsID[p]&&this.changeImage(t,c,this.picsID[p])),o<=0&&t<this.MIN_TOP_SCROLL_SPACE?setTimeout(()=>{this.changeImage(t,c,this.picsID[0]),this.isScrolling=!1},a):(clearTimeout(this.isScrolling),this.isScrolling=setTimeout(()=>{this.setFreezeStyles(t)},a))},changeImage:function(t,e,i){(t>this.lastScrollTop&&t>=e*this.delay||t<this.lastScrollTop&&t>=(e-1)*this.delay)&&this.player.moveToImage(i,!0,"switch-to-image-scroll"),this.lastScrollTop=t<=0?0:t},setFreezeStyles:function(){let t=this.$el.find(".center-image"),e=this.$el.find(".prev-image"),i=this.getRealOpacity(t.css("opacity")),s=this.getRealOpacity(e.css("opacity"));this.isCrossfade&&(t.css({opacity:i>s?i:1-s}),e.css({opacity:s>i?s:1-i}),!t.hasClass("changed-opacity")&&!e.hasClass("changed-opacity")&&e.addClass("changed-opacity"))},getRealOpacity:function(t){return t<.1?t*10:t},renderNounIcons:function(){let t=this.theme_data.arrows_position,e=this.left_arrow_noun&&this.left_arrow_noun.rasterUrl?this.left_arrow_noun:this.theme_data.left_icon_noun,i=this.right_arrow_noun&&this.right_arrow_noun.rasterUrl?this.right_arrow_noun:this.theme_data.right_icon_noun;if(e&&(e.rasterUrl||e.b64url)){let s=(0,T.default)("<img>");s.on("load",S.default.bind(function(){t==="bottom"?this.$el.find(".prev-picture-arrow-bottom").empty().html(s.clone()):this.$el.find(".prev-picture-arrow-middle").empty().html(s.clone())},this)).on("error",this.widgetIsLoaded),s.attr("src",e.raster3xUrl||e.raster2xUrl||e.rasterUrl||e.b64url||"")}if(i&&(i.rasterUrl||i.b64url)){let s=(0,T.default)("<img>");s.on("load",S.default.bind(function(){t==="bottom"?this.$el.find(".next-picture-arrow-bottom").empty().html(s.clone()):this.$el.find(".next-picture-arrow-middle").empty().html(s.clone())},this)).on("error",this.widgetIsLoaded),s.attr("src",i.raster3xUrl||i.raster2xUrl||i.rasterUrl||i.b64url||"")}},isValid:function(){return this.pictures&&this.pictures.length},start:function(){return A.prototype.start.call(this),!RM.screenshot&&!this.destroyed&&this.player&&(this.theme_data.autoplay&&this.play_method===void 0||this.play_method==="autoplay")&&this.rendered&&this.loaded&&this.player.startAutoplay(),this},stop:function(){return A.prototype.stop.call(this),!RM.screenshot&&!this.destroyed&&this.player&&this.rendered&&this.loaded&&this.player.stopAutoplay(),this},destroy:function(){return this.player&&this.player.off(),this.player&&this.player.destroy(),this.player=null,this.play_method==="scroll"&&(0,T.default)(window).off("scroll",this.onScrollTransition),A.prototype.destroy.apply(this,arguments)}}),Et=vt});export{J as a,Q as b,Et as c,It as d};
